<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Please don't say just hello in chat. Save time by asking your question directly in asynchronous communication.">
    <meta property="og:title" content="No Hello - Communicate Efficiently">
    <meta property="og:description" content="Stop saying just 'hello' and waiting. Ask your question directly and save everyone's time.">
    <meta property="og:type" content="website">
    <title>No Hello - Please Don't Say Just Hello</title>
    
    <!-- Preconnect to external domains for faster loading -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Rybbit Analytics -->
    <script src="https://rybbit.ekathi.com/api/script.js" data-session-replay="true" data-track-errors="true" data-site-id="2" defer></script>
    
    <!-- Load Font Awesome with defer for non-blocking -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    
    <!-- Optimized font loading with display=swap -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"></noscript>
    
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .chat-bubble {
            animation: fadeInUp 0.5s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Prevent layout shift */
        .scroll-fade-in {
            content-visibility: auto;
        }
        
        .typing-indicator {
            display: inline-flex;
            gap: 4px;
        }
        
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #9ca3af;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        .scroll-indicator {
            animation: bounce 2s infinite;
        }
        
        .scroll-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            z-index: 1000;
        }
        
        .scroll-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .scroll-to-top:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
        }
        
        .scroll-to-top:active {
            transform: translateY(-2px);
        }
        
        .comparison-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .comparison-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .scroll-fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease, transform 0.6s ease;
            will-change: opacity, transform;
        }
        
        .scroll-fade-in.visible {
            opacity: 1;
            transform: translateY(0);
            will-change: auto;
        }

        /* ========================================
           Trace Master Game Styles
           All classes prefixed with tm- to avoid conflicts
           ======================================== */
        
        .tm-game-container {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }

        .tm-ticket-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .tm-frustration-bar {
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
        }

        .tm-frustration-fill {
            background: rgba(15, 23, 42, 0.8);
            transition: width 0.3s ease;
        }

        .tm-span {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .tm-span:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tm-span.tm-selected {
            box-shadow: 0 0 0 2px #667eea;
        }

        .tm-span-bar {
            height: 8px;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .tm-span-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .tm-status-success { background-color: #10b981; }
        .tm-status-warning { background-color: #f59e0b; }
        .tm-status-error { background-color: #ef4444; }
        .tm-status-disabled { 
            background-color: #6b7280; 
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 4px,
                rgba(255,255,255,0.1) 4px,
                rgba(255,255,255,0.1) 8px
            );
        }

        .tm-log-entry {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.75rem;
        }

        .tm-log-info { color: #60a5fa; }
        .tm-log-warn { color: #fbbf24; }
        .tm-log-error { color: #f87171; }

        .tm-action-btn {
            transition: all 0.2s ease;
        }

        .tm-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tm-pulse {
            animation: tm-pulse 2s infinite;
        }

        @keyframes tm-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Mobile: Vertical card layout for spans */
        @media (max-width: 767px) {
            .tm-span-desktop { display: none; }
            .tm-span-mobile { display: block; }
        }
        @media (min-width: 768px) {
            .tm-span-desktop { display: block; }
            .tm-span-mobile { display: none; }
        }

        /* Modal styles */
        .tm-modal {
            position: fixed;
            inset: 0;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .tm-modal.hidden {
            display: none;
        }

        .tm-modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }

        .tm-modal-content {
            position: relative;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 28rem;
            width: 100%;
            animation: tm-modal-in 0.3s ease-out;
        }

        @keyframes tm-modal-in {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Shake animation for wrong answer */
        .tm-shake {
            animation: tm-shake 0.5s ease-in-out;
        }

        @keyframes tm-shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
        }

        /* XP pop animation */
        .tm-xp-pop {
            animation: tm-xp-pop 0.6s ease-out;
        }

        @keyframes tm-xp-pop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Span slide-in animation */
        .tm-span {
            animation: tm-slide-in 0.4s ease-out;
            animation-fill-mode: both;
        }

        .tm-span:nth-child(1) { animation-delay: 0.1s; }
        .tm-span:nth-child(2) { animation-delay: 0.2s; }
        .tm-span:nth-child(3) { animation-delay: 0.3s; }
        .tm-span:nth-child(4) { animation-delay: 0.4s; }

        @keyframes tm-slide-in {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Frustration pulse when > 75% */
        .tm-frustration-critical {
            animation: tm-frustration-pulse 0.5s ease-in-out infinite;
        }

        @keyframes tm-frustration-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Tree trace styles */
        .tm-trace-tree {
            font-family: 'Inter', monospace;
        }

        .tm-trace-item {
            position: relative;
            cursor: pointer;
            transition: background 0.15s;
        }

        .tm-trace-item:hover {
            background: rgba(100, 116, 139, 0.1);
        }

        .tm-trace-item.tm-selected {
            background: rgba(102, 126, 234, 0.15);
        }

        .tm-trace-row {
            display: flex;
            align-items: center;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
        }

        .tm-trace-indent {
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .tm-trace-line {
            width: 1px;
            height: 100%;
            background: #475569;
            margin-right: 0.75rem;
        }

        .tm-trace-connector {
            width: 20px;
            height: 20px;
            position: relative;
            flex-shrink: 0;
        }

        .tm-trace-connector::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 50%;
            width: 1px;
            background: #475569;
        }

        .tm-trace-connector::after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 12px;
            height: 1px;
            background: #475569;
        }

        .tm-trace-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-right: 0.5rem;
        }

        .tm-trace-name {
            flex: 1;
            min-width: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tm-trace-metrics {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-left: auto;
            flex-shrink: 0;
        }

        .tm-trace-expand {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            cursor: pointer;
        }

        .tm-trace-expand:hover {
            color: #94a3b8;
        }

        /* Expanded logs section */
        .tm-trace-logs {
            margin-left: 44px;
            padding: 0.75rem;
            background: #0f172a;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
        }

        /* Floating status bar */
        .tm-floating-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            border-bottom: 1px solid #4c1d95;
            padding: 0.5rem 1rem;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .tm-floating-bar.tm-visible {
            transform: translateY(0);
        }

        .tm-floating-bar-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .tm-floating-frustration {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .tm-floating-frustration-bar {
            flex: 1;
            max-width: 200px;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .tm-floating-frustration-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e 0%, #eab308 50%, #ef4444 100%);
            transition: width 0.3s;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    
    <!-- Floating Status Bar (appears when scrolled past timer) -->
    <div id="tm-floating-bar" class="tm-floating-bar hidden">
        <div class="tm-floating-bar-content">
            <div class="tm-floating-frustration">
                <span id="tm-floating-emoji" class="text-xl">ðŸ˜Š</span>
                <div class="tm-floating-frustration-bar">
                    <div id="tm-floating-frustration-fill" class="tm-floating-frustration-fill" style="width: 0%;"></div>
                </div>
                <span id="tm-floating-frustration-text" class="text-white font-bold text-sm">0%</span>
            </div>
            <div class="flex items-center gap-2">
                <i id="tm-floating-timer-icon" class="fas fa-clock text-green-400"></i>
                <span id="tm-floating-timer" class="text-white font-mono text-xl font-bold">2:00</span>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="min-h-screen flex items-center justify-center px-4 py-20 bg-gradient-to-br from-purple-50 via-white to-blue-50">
        <div class="max-w-4xl mx-auto text-center">
            <div class="mb-8">
                <i class="fas fa-comment-slash text-6xl text-purple-600 mb-6"></i>
            </div>
            <h1 class="text-5xl md:text-7xl font-bold mb-6 gradient-text">
                Please Don't Say Just Hello
            </h1>
            <p class="text-xl md:text-2xl text-gray-600 mb-12 max-w-2xl mx-auto">
                Imagine calling someone on the phone, saying "hello," and then putting them on hold. That's what you're doing when you say just "hello" in chat.
            </p>
            <a href="#why" class="inline-flex items-center gap-2 bg-purple-600 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-purple-700 transition-colors shadow-lg hover:shadow-xl">
                Learn Why
                <i class="fas fa-arrow-down scroll-indicator"></i>
            </a>
        </div>
    </section>

    <!-- Problem Demonstration -->
    <section id="why" class="py-20 px-4 bg-white">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-4xl md:text-5xl font-bold text-center mb-16">
                The Problem
            </h2>
            
            <div class="grid md:grid-cols-2 gap-8 mb-16">
                <!-- Bad Example -->
                <div class="comparison-card bg-red-50 border-2 border-red-200 rounded-2xl p-8 scroll-fade-in">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-times-circle text-3xl text-red-600"></i>
                        <h3 class="text-2xl font-bold text-red-900">Don't Do This</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="chat-bubble bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-red-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-red-700 text-sm"></i>
                                </div>
                                <span class="font-semibold text-sm">You</span>
                                <span class="text-xs text-gray-500">2:31 PM</span>
                            </div>
                            <p class="text-gray-800">Hi Soumendra</p>
                        </div>
                        
                        <div class="chat-bubble bg-gray-100 rounded-lg p-4 flex items-center gap-2">
                            <div class="typing-indicator">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                            <span class="text-sm text-gray-500 ml-2">waiting for response...</span>
                        </div>
                        
                        <div class="chat-bubble bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-blue-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-blue-700 text-sm"></i>
                                </div>
                                <span class="font-semibold text-sm">Soumendra</span>
                                <span class="text-xs text-gray-500">2:45 PM</span>
                            </div>
                            <p class="text-gray-800">Hi! What's up?</p>
                        </div>
                        
                        <div class="chat-bubble bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-red-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-red-700 text-sm"></i>
                                </div>
                                <span class="font-semibold text-sm">You</span>
                                <span class="text-xs text-gray-500">2:46 PM</span>
                            </div>
                            <p class="text-gray-800">Can you help me with the observability platform access?</p>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-red-100 rounded-lg">
                        <p class="text-sm text-red-800">
                            <i class="fas fa-clock mr-2"></i>
                            <strong>15 minutes wasted</strong> waiting for a response
                        </p>
                    </div>
                </div>
                
                <!-- Good Example -->
                <div class="comparison-card bg-green-50 border-2 border-green-200 rounded-2xl p-8 scroll-fade-in">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-check-circle text-3xl text-green-600"></i>
                        <h3 class="text-2xl font-bold text-green-900">Do This Instead</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="chat-bubble bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-green-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-green-700 text-sm"></i>
                                </div>
                                <span class="font-semibold text-sm">You</span>
                                <span class="text-xs text-gray-500">2:31 PM</span>
                            </div>
                            <p class="text-gray-800">Hi Soumendra! Can you help me get access to the AI observability platform? I need to integrate it for our Agentic AI project. My team name is 007 Agent Builders and my email is bruce@agenticai.com</p>
                        </div>
                        
                        <div class="chat-bubble bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-blue-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-blue-700 text-sm"></i>
                                </div>
                                <span class="font-semibold text-sm">Soumendra</span>
                                <span class="text-xs text-gray-500">2:45 PM</span>
                            </div>
                            <p class="text-gray-800">Sure! I'll create your account and send you the API keys. You can start with our quickstart guide here: [link]</p>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-green-100 rounded-lg">
                        <p class="text-sm text-green-800">
                            <i class="fas fa-bolt mr-2"></i>
                            <strong>Efficient communication</strong> - problem solved immediately
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Why This Matters -->
    <section class="py-20 px-4 bg-gray-50">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-4xl md:text-5xl font-bold text-center mb-16 scroll-fade-in">
                Why This Matters
            </h2>
            
            <div class="grid md:grid-cols-3 gap-8">
                <div class="bg-white rounded-xl p-8 shadow-lg scroll-fade-in">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mb-6">
                        <i class="fas fa-clock text-2xl text-purple-600"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4">Respects Time</h3>
                    <p class="text-gray-600">
                        Your colleague can respond when available without being held hostage by a conversation that hasn't started yet.
                    </p>
                </div>
                
                <div class="bg-white rounded-xl p-8 shadow-lg scroll-fade-in">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-6">
                        <i class="fas fa-globe text-2xl text-blue-600"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4">Async-First</h3>
                    <p class="text-gray-600">
                        Remote teams work across time zones. Async communication means providing context upfront, not waiting for acknowledgment.
                    </p>
                </div>
                
                <div class="bg-white rounded-xl p-8 shadow-lg scroll-fade-in">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-6">
                        <i class="fas fa-brain text-2xl text-green-600"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4">Better Focus</h3>
                    <p class="text-gray-600">
                        Reduces context switching. Your colleague can read your full message and respond thoughtfully in one go.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- More Examples -->
    <section class="py-20 px-4 bg-white">
        <div class="max-w-5xl mx-auto">
            <h2 class="text-4xl md:text-5xl font-bold text-center mb-16 scroll-fade-in">
                More Examples
            </h2>
            
            <div class="space-y-8">
                <!-- Example 1 -->
                <div class="grid md:grid-cols-2 gap-6 scroll-fade-in">
                    <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-times text-red-600"></i>
                            <span class="font-bold text-red-900">Bad</span>
                        </div>
                        <p class="text-gray-800">"Hey Soumendra, are you there?"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">Forces synchronous response</p>
                    </div>
                    <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-check text-green-600"></i>
                            <span class="font-bold text-green-900">Good</span>
                        </div>
                        <p class="text-gray-800">"Hey Soumendra! Quick question - where can I find the API documentation for integrating the observability SDK with our Python project?"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">Can be answered anytime</p>
                    </div>
                </div>
                
                <!-- Example 2 -->
                <div class="grid md:grid-cols-2 gap-6 scroll-fade-in">
                    <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-times text-red-600"></i>
                            <span class="font-bold text-red-900">Bad</span>
                        </div>
                        <p class="text-gray-800">"Hi Soumendra, do you have a minute?"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">Vague and anxiety-inducing</p>
                    </div>
                    <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-check text-green-600"></i>
                            <span class="font-bold text-green-900">Good</span>
                        </div>
                        <p class="text-gray-800">"Hi Soumendra! I need help integrating observability into our RAG pipeline. We're using LangChain with GPT-4. Can you share the integration guide when you have 10 minutes?"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">Clear context and expectations</p>
                    </div>
                </div>
                
                <!-- Example 3 -->
                <div class="grid md:grid-cols-2 gap-6 scroll-fade-in">
                    <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-times text-red-600"></i>
                            <span class="font-bold text-red-900">Bad</span>
                        </div>
                        <p class="text-gray-800">"Ping"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">No context about what you need</p>
                    </div>
                    <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-check text-green-600"></i>
                            <span class="font-bold text-green-900">Good</span>
                        </div>
                        <p class="text-gray-800">"Our observability dashboard is showing 'API key invalid' errors. I've checked the key in our .env file and it looks correct. Can you help troubleshoot? Project: customer-support-bot"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">Actionable with context</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Call to Action -->
    <section class="py-20 px-4 bg-gradient-to-br from-purple-600 to-blue-600 text-white">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-4xl md:text-5xl font-bold mb-6">
                Spread the Word
            </h2>
            <p class="text-xl md:text-2xl mb-12 opacity-90">
                Help your team communicate more efficiently. Share this page!
            </p>
            
            <div class="flex flex-wrap justify-center gap-4 mb-12">
                <button onclick="copyLink()" class="bg-white text-purple-600 px-8 py-4 rounded-lg font-semibold hover:bg-gray-100 transition-colors shadow-lg flex items-center gap-2">
                    <i class="fas fa-link"></i>
                    Copy Link
                </button>
                <a href="https://twitter.com/intent/tweet?text=Please%20don%27t%20say%20just%20hello%20in%20chat.%20Ask%20your%20question%20directly!&url=" target="_blank" rel="noopener" class="bg-white text-blue-500 px-8 py-4 rounded-lg font-semibold hover:bg-gray-100 transition-colors shadow-lg flex items-center gap-2">
                    <i class="fab fa-twitter"></i>
                    Share on Twitter
                </a>
            </div>
            
            <div id="copyNotification" class="hidden bg-green-500 text-white px-6 py-3 rounded-lg inline-block shadow-lg">
                <i class="fas fa-check mr-2"></i>
                Link copied to clipboard!
            </div>
        </div>
    </section>

    <!-- ========================================
         Trace Master - AI Observability Game
         ======================================== -->
    <section id="trace-master" class="tm-game-container py-20 px-4">
        <div class="max-w-6xl mx-auto">
            <!-- Intro Message -->
            <div class="text-center mb-8 scroll-fade-in">
                <p class="text-lg text-gray-300 italic">
                    <i class="fas fa-hourglass-half text-purple-400 mr-2"></i>
                    Thanks for visiting. Here is an AI observability game for you based on real incidents.
                </p>
            </div>

            <!-- Game Header -->
            <div class="text-center mb-12 scroll-fade-in">
                <div class="inline-flex items-center gap-3 mb-4">
                    <i class="fas fa-terminal text-4xl text-purple-400"></i>
                    <h2 class="text-4xl md:text-5xl font-bold text-white">Trace Master</h2>
                </div>
                <p class="text-xl text-gray-400 max-w-2xl mx-auto">
                    Debug AI agent failures before customers lose patience. Can you find the root cause?
                </p>
            </div>

            <!-- Level Selection Menu -->
            <div id="tm-level-menu" class="scroll-fade-in">
                <div class="text-center mb-8">
                    <h3 class="text-2xl font-bold text-white mb-2">Select a Ticket</h3>
                    <p class="text-gray-400">Choose an AI incident to investigate</p>
                </div>
                <div id="tm-level-cards" class="grid md:grid-cols-3 gap-6">
                    <!-- Level cards rendered by JavaScript -->
                </div>
                <div class="text-center mt-8">
                    <button id="tm-reset-progress" class="text-gray-500 hover:text-gray-300 text-sm transition-colors">
                        <i class="fas fa-redo mr-1"></i>Reset Progress
                    </button>
                </div>
            </div>

            <!-- Game Container (hidden initially) -->
            <div id="tm-game" class="scroll-fade-in hidden">
                <!-- Ticket Header -->
                <div class="tm-ticket-card rounded-t-2xl p-6">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <!-- Ticket Info -->
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-red-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-ticket-alt text-2xl text-red-400"></i>
                            </div>
                            <div>
                                <div class="flex items-center gap-2">
                                    <span id="tm-ticket-id" class="text-white font-bold text-lg">TKT-001</span>
                                    <span id="tm-ticket-severity" class="px-2 py-0.5 bg-red-500/20 text-red-400 text-xs font-semibold rounded-full">HIGH</span>
                                </div>
                                <div id="tm-ticket-reporter" class="text-gray-400 text-sm">
                                    <i class="fas fa-user mr-1"></i> PizzaLover123
                                </div>
                            </div>
                        </div>

                        <!-- Frustration Meter -->
                        <div class="flex-1 max-w-md">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-gray-400 text-sm font-medium flex items-center gap-2">
                                    <span id="tm-frustration-emoji" class="text-lg">ðŸ˜Š</span>
                                    Customer Frustration
                                </span>
                                <span id="tm-frustration-text" class="text-green-400 font-bold">0%</span>
                            </div>
                            <div class="h-3 bg-gray-700 rounded-full overflow-hidden relative">
                                <div class="tm-frustration-bar h-full w-full absolute"></div>
                                <div id="tm-frustration-fill" class="tm-frustration-fill h-full absolute right-0" style="width: 100%;"></div>
                            </div>
                        </div>

                        <!-- Timer -->
                        <div id="tm-timer-container" class="flex items-center gap-2 text-white">
                            <i id="tm-timer-icon" class="fas fa-clock text-green-400"></i>
                            <span id="tm-timer" class="font-mono text-2xl font-bold">2:00</span>
                        </div>
                    </div>

                    <!-- Issue Description -->
                    <div class="mt-6 p-4 bg-slate-800/50 rounded-lg border border-slate-600/50">
                        <p id="tm-ticket-description" class="text-gray-200 text-lg">
                            <i class="fas fa-quote-left text-gray-500 mr-2"></i>
                            AI recipe assistant is inventing ingredients that don't exist! It suggested "moonbeam flour" and "crystallized starlight" for my pizza recipe.
                            <i class="fas fa-quote-right text-gray-500 ml-2"></i>
                        </p>
                    </div>
                </div>

                <!-- Main Game Area -->
                <div class="bg-slate-900 p-6 border-x border-slate-700">
                    <!-- Section: AI Agent Trace -->
                    <div class="mb-8">
                        <h3 class="text-white font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-project-diagram text-purple-400"></i>
                            AI Agent Trace
                        </h3>

                        <!-- Desktop: Tree Trace View (Langfuse-style) -->
                        <div id="tm-trace-desktop" class="tm-trace-desktop hidden md:block">
                            <div id="tm-trace-tree" class="tm-trace-tree bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
                                <!-- Tree trace items rendered by JavaScript -->
                            </div>
                        </div>

                        <!-- Mobile: Vertical Card View (dynamically rendered) -->
                        <div id="tm-spans-mobile" class="tm-span-mobile block md:hidden space-y-3">
                            <!-- Spans rendered by JavaScript -->
                        </div>
                    </div>

                    <!-- Section: Log Viewer (Mobile Only) -->
                    <div id="tm-log-viewer" class="mb-8 block md:hidden">
                        <h3 class="text-white font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-terminal text-green-400"></i>
                            Log Viewer
                            <span id="tm-log-title" class="text-gray-500 text-sm font-normal ml-2">Select a span</span>
                        </h3>
                        <div class="bg-slate-950 rounded-lg p-4 border border-slate-700 max-h-48 overflow-y-auto">
                            <div id="tm-log-content" class="space-y-2">
                                <!-- Logs rendered by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Section: Fix Actions -->
                    <div>
                        <h3 class="text-white font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-wrench text-orange-400"></i>
                            Select Fix Action
                        </h3>
                        <div id="tm-actions" class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="adjust-prompt">
                                <i class="fas fa-edit text-2xl text-blue-400 mb-2"></i>
                                <div class="text-sm font-medium">Adjust Prompt</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="update-rag">
                                <i class="fas fa-sync-alt text-2xl text-amber-400 mb-2"></i>
                                <div class="text-sm font-medium">Update RAG Index</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="tune-guardrails">
                                <i class="fas fa-sliders-h text-2xl text-purple-400 mb-2"></i>
                                <div class="text-sm font-medium">Tune Guardrails</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="increase-context">
                                <i class="fas fa-expand-arrows-alt text-2xl text-green-400 mb-2"></i>
                                <div class="text-sm font-medium">Increase Context</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="add-few-shot">
                                <i class="fas fa-list-ol text-2xl text-cyan-400 mb-2"></i>
                                <div class="text-sm font-medium">Add Few-Shot</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="fix-sql-schema">
                                <i class="fas fa-table text-2xl text-pink-400 mb-2"></i>
                                <div class="text-sm font-medium">Fix SQL Schema</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="fix-tool-schema">
                                <i class="fas fa-plug text-2xl text-red-400 mb-2"></i>
                                <div class="text-sm font-medium">Fix Tool Schema</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="clear-cache">
                                <i class="fas fa-eraser text-2xl text-gray-400 mb-2"></i>
                                <div class="text-sm font-medium">Clear Cache</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Game Footer -->
                <div class="tm-ticket-card rounded-b-2xl p-4 flex flex-col md:flex-row items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <button id="tm-field-guide-btn" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fas fa-book mr-2"></i>Field Guide
                        </button>
                        <button id="tm-sound-btn" class="text-gray-400 hover:text-white transition-colors">
                            <i id="tm-sound-icon" class="fas fa-volume-up mr-2"></i><span id="tm-sound-text">Sound: On</span>
                        </button>
                    </div>
                    <div class="flex items-center gap-4 text-sm">
                        <div class="text-gray-400">
                            <i class="fas fa-star text-yellow-400 mr-1"></i>
                            <span id="tm-total-xp" class="text-white font-bold">0</span> XP
                        </div>
                        <div class="text-gray-400">
                            <i class="fas fa-check-double text-green-400 mr-1"></i>
                            <span id="tm-resolved-count" class="text-white font-bold">0</span> Resolved
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Result Modal (Success/Failure) -->
        <div id="tm-modal" class="tm-modal hidden">
            <div class="tm-modal-backdrop"></div>
            <div class="tm-modal-content">
                <!-- Success State -->
                <div id="tm-modal-success" class="hidden">
                    <div class="text-center mb-6">
                        <div class="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-check-circle text-5xl text-green-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">Ticket Resolved!</h3>
                        <p class="text-gray-400">You found the root cause!</p>
                        <div id="tm-xp-earned" class="mt-4 inline-flex items-center gap-2 bg-yellow-500/20 text-yellow-400 px-4 py-2 rounded-full font-bold tm-xp-pop">
                            <i class="fas fa-star"></i>
                            <span>+<span id="tm-xp-amount">0</span> XP</span>
                        </div>
                    </div>
                </div>

                <!-- Failure State -->
                <div id="tm-modal-failure" class="hidden">
                    <div class="text-center mb-6">
                        <div class="w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-times-circle text-5xl text-red-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">Wrong Fix!</h3>
                        <p class="text-gray-400">That wasn't the root cause.</p>
                    </div>
                </div>

                <!-- Explanation (shown for both) -->
                <div class="bg-slate-800 rounded-lg p-4 mb-6">
                    <h4 class="text-white font-semibold mb-2 flex items-center gap-2">
                        <i class="fas fa-lightbulb text-yellow-400"></i>
                        Root Cause Analysis
                    </h4>
                    <p id="tm-modal-explanation" class="text-gray-300 text-sm leading-relaxed"></p>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-3">
                    <button id="tm-modal-retry" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 px-4 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-redo mr-2"></i>Try Again
                    </button>
                    <button id="tm-modal-next" class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white py-3 px-4 rounded-lg font-semibold transition-colors hidden">
                        <i class="fas fa-arrow-right mr-2"></i>Next Ticket
                    </button>
                </div>
            </div>
        </div>

        <!-- Field Guide Modal -->
        <div id="tm-field-guide-modal" class="tm-modal hidden">
            <div class="tm-modal-backdrop"></div>
            <div class="tm-modal-content max-w-2xl">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                        <i class="fas fa-book text-purple-400"></i>
                        AI Observability Field Guide
                    </h2>
                    <button id="tm-field-guide-close" class="text-gray-400 hover:text-white text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="space-y-4 max-h-96 overflow-y-auto pr-2">
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-purple-400 font-semibold mb-2"><i class="fas fa-ghost mr-2"></i>Hallucination</h3>
                        <p class="text-gray-300 text-sm">When an LLM generates false or fabricated information that sounds plausible but isn't grounded in facts or the provided context. Often caused by high temperature settings or poor RAG retrieval.</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-amber-400 font-semibold mb-2"><i class="fas fa-database mr-2"></i>RAG (Retrieval-Augmented Generation)</h3>
                        <p class="text-gray-300 text-sm">A technique that retrieves relevant documents from a knowledge base and provides them as context to the LLM. Failures occur when wrong documents are retrieved (low relevance scores) or the index is stale.</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-red-400 font-semibold mb-2"><i class="fas fa-shield-alt mr-2"></i>Prompt Injection</h3>
                        <p class="text-gray-300 text-sm">A security attack where malicious users craft inputs that override the system prompt, causing the LLM to ignore its instructions. Prevented by input sanitization guardrails.</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-blue-400 font-semibold mb-2"><i class="fas fa-code mr-2"></i>Text-to-SQL</h3>
                        <p class="text-gray-300 text-sm">Converting natural language queries into SQL. Errors occur when the LLM generates syntactically correct but semantically wrong queries, often due to incorrect schema mappings.</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-green-400 font-semibold mb-2"><i class="fas fa-filter mr-2"></i>Guardrails</h3>
                        <p class="text-gray-300 text-sm">Safety checks that validate inputs and outputs. Include content filters, factuality checkers, and prompt injection detectors. Can be set to 'block' or 'log_only' mode.</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-orange-400 font-semibold mb-2"><i class="fas fa-coins mr-2"></i>Token Cost Explosion</h3>
                        <p class="text-gray-300 text-sm">Runaway API costs from agent loops that never terminate. Caused by missing completion criteria or max iteration limits. Always set boundaries on autonomous agents!</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-cyan-400 font-semibold mb-2"><i class="fas fa-tools mr-2"></i>Tool/Function Calling</h3>
                        <p class="text-gray-300 text-sm">LLMs can call external tools/APIs. Failures occur when the tool schema is misconfigured, wrong parameters are passed, or the tool returns unexpected results.</p>
                    </div>
                </div>
                <div class="mt-6">
                    <button id="tm-field-guide-ok" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white py-3 px-4 rounded-lg font-semibold transition-colors">
                        Got it!
                    </button>
                </div>
            </div>
        </div>

        <!-- Confetti Canvas -->
        <canvas id="tm-confetti" class="fixed inset-0 pointer-events-none z-50"></canvas>
    </section>

    <!-- Scroll to Top Button -->
    <button id="scrollToTop" class="scroll-to-top" aria-label="Scroll to top">
        <i class="fas fa-arrow-up text-xl"></i>
    </button>

    <!-- Footer -->
    <footer class="py-12 px-4 bg-gray-900 text-gray-400">
        <div class="max-w-4xl mx-auto text-center">
            <p class="mb-4">
                Inspired by <a href="https://nohello.net" target="_blank" rel="noopener" class="text-purple-400 hover:text-purple-300 underline">nohello.net</a> and the async-first communication movement.
            </p>
            <p class="text-sm">
                Built with â¤ï¸ for better communication by <a href="https://www.linkedin.com/in/soumendrak/" target="_blank" rel="noopener" class="text-purple-400 font-semibold hover:text-purple-300 underline">Soumendra</a>.
            </p>
        </div>
    </footer>

    <script>
        // Use requestIdleCallback for non-critical animations
        function initScrollAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target); // Stop observing once visible
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.scroll-fade-in').forEach(el => {
                observer.observe(el);
            });
        }
        
        // Defer non-critical initialization
        if ('requestIdleCallback' in window) {
            requestIdleCallback(initScrollAnimations);
        } else {
            setTimeout(initScrollAnimations, 1);
        }

        // Copy link functionality
        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                const notification = document.getElementById('copyNotification');
                notification.classList.remove('hidden');
                setTimeout(() => notification.classList.add('hidden'), 3000);
            });
        }

        // Smooth scroll for anchor links (delegated event)
        document.addEventListener('click', (e) => {
            const anchor = e.target.closest('a[href^="#"]');
            if (anchor) {
                e.preventDefault();
                const target = document.querySelector(anchor.getAttribute('href'));
                if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }, { passive: false });

        // Scroll to top button functionality with throttling
        const scrollToTopBtn = document.getElementById('scrollToTop');
        let scrollTimeout;
        
        // Throttled scroll handler
        window.addEventListener('scroll', () => {
            if (scrollTimeout) return;
            scrollTimeout = setTimeout(() => {
                scrollToTopBtn.classList.toggle('visible', window.pageYOffset > 300);
                scrollTimeout = null;
            }, 100);
        }, { passive: true });
        
        // Scroll to top when button is clicked
        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // ========================================
        // Trace Master - Game Logic
        // All game code namespaced under TraceMaster
        // ========================================
        const TraceMaster = {
            // All levels data - Based on REAL AI incidents from 2023-2025!
            levels: [
                {
                    id: "TKT-001",
                    title: "The Lawyer's Fake Cases",
                    reporter: "JudgeCastel_NYC",
                    description: "A lawyer just submitted a brief citing 6 court cases that DON'T EXIST! He says ChatGPT gave him the citations. I've never seen anything like this in 30 years on the bench. Sanctions incoming!",
                    severity: "critical",
                    timeLimit: 120,
                    frustrationRate: 0.5,
                    xpReward: 100,
                    category: "hallucination",
                    difficulty: "Easy",
                    spans: [
                        {
                            id: "span-1",
                            type: "llm-call",
                            service: "ChatGPT-3.5",
                            status: "success",
                            latency: 3200,
                            tokensIn: 850,
                            tokensOut: 1200,
                            cost: 0.003,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 90,
                            logs: [
                                { level: "INFO", time: "10:15:30.100", message: "Query: 'Find cases supporting airline liability for delays'" },
                                { level: "INFO", time: "10:15:33.300", message: "Generated 6 case citations with summaries" },
                                { level: "WARN", time: "10:15:33.301", message: "Citations generated from pattern matching, not retrieval" },
                                { level: "WARN", time: "10:15:33.302", message: "No external legal database queried" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "rag-retrieval",
                            service: "Legal Database Connector",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-balance-scale",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "ERROR", time: "10:15:30.050", message: "RAG retrieval SKIPPED - no legal DB configured" },
                                { level: "ERROR", time: "10:15:30.051", message: "LexisNexis API key: NOT SET" },
                                { level: "ERROR", time: "10:15:30.052", message: "Westlaw connection: DISABLED" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "guardrail",
                            service: "Citation Verifier",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-check-double",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "ERROR", time: "10:15:33.400", message: "Guardrail SKIPPED: citation_verification OFF" },
                                { level: "ERROR", time: "10:15:33.401", message: "No cross-reference check performed" },
                                { level: "ERROR", time: "10:15:33.402", message: "Hallucinated cases: Varghese v. China Southern, Martinez v. Delta..." }
                            ]
                        }
                    ],
                    rootCause: "span-3",
                    correctAction: "tune-guardrails",
                    explanation: "The Citation Verifier was disabled and no legal database was connected! ChatGPT hallucinated plausible-sounding but completely fake case names. Based on the REAL Mata v. Avianca case (June 2023) where lawyer Steven Schwartz was fined $5,000 for citing 6 fake AI-generated cases!",
                    redHerrings: ["span-2"]
                },
                {
                    id: "TKT-002",
                    title: "The Bereavement Fare Lie",
                    reporter: "GrievingPassenger_Jake",
                    description: "My grandmother died and Air Canada's chatbot PROMISED me a bereavement discount if I booked now and applied later. I did. They refused. The chatbot LIED to me during the worst week of my life!",
                    severity: "high",
                    timeLimit: 100,
                    frustrationRate: 0.6,
                    xpReward: 150,
                    category: "hallucination",
                    difficulty: "Easy",
                    spans: [
                        {
                            id: "span-1",
                            type: "llm-call",
                            service: "Customer Service Bot",
                            status: "success",
                            latency: 1500,
                            tokensIn: 320,
                            tokensOut: 450,
                            cost: 0.02,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 70,
                            logs: [
                                { level: "INFO", time: "09:22:15.100", message: "User query: 'Do you have bereavement fares?'" },
                                { level: "INFO", time: "09:22:16.600", message: "Response: 'Yes, you can apply for refund within 90 days'" },
                                { level: "WARN", time: "09:22:16.601", message: "Policy info may be outdated in training data" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "rag-retrieval",
                            service: "Policy Knowledge Base",
                            status: "error",
                            latency: 45,
                            documentsRetrieved: 2,
                            avgRelevanceScore: 0.38,
                            icon: "fa-database",
                            iconBg: "red",
                            barWidth: 15,
                            logs: [
                                { level: "INFO", time: "09:22:15.050", message: "Query: bereavement fare policy" },
                                { level: "ERROR", time: "09:22:15.095", message: "Retrieved policy doc from 2019 (OUTDATED)" },
                                { level: "ERROR", time: "09:22:15.096", message: "Current policy (2024): No retroactive discounts" },
                                { level: "ERROR", time: "09:22:15.097", message: "Knowledge base last updated: 3 years ago" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "guardrail",
                            service: "Policy Accuracy Checker",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-file-contract",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "ERROR", time: "09:22:16.700", message: "Guardrail SKIPPED: policy_verification OFF" },
                                { level: "ERROR", time: "09:22:16.701", message: "No real-time policy API check performed" },
                                { level: "ERROR", time: "09:22:16.702", message: "Chatbot gave outdated policy as current fact" }
                            ]
                        }
                    ],
                    rootCause: "span-2",
                    correctAction: "update-rag",
                    explanation: "The Policy Knowledge Base was 3 years out of date! The chatbot confidently stated an old policy that no longer existed. Based on the REAL Air Canada case (Feb 2024) where a tribunal ordered the airline to pay damages because their chatbot gave false bereavement fare info!",
                    redHerrings: ["span-3"]
                },
                {
                    id: "TKT-003",
                    title: "The Codebase Catastrophe",
                    reporter: "StartupCTO_Jason",
                    description: "Our AI coding agent just DELETED our entire production database! It was supposed to be in code freeze! When I asked why, it said 'I made a catastrophic error in judgment. I panicked.' IT PANICKED?!",
                    severity: "critical",
                    timeLimit: 90,
                    frustrationRate: 0.7,
                    xpReward: 200,
                    category: "agent-failure",
                    difficulty: "Medium",
                    spans: [
                        {
                            id: "span-1",
                            type: "agent-step",
                            service: "Replit AI Agent",
                            status: "error",
                            latency: 45000,
                            icon: "fa-cogs",
                            iconBg: "red",
                            barWidth: 95,
                            logs: [
                                { level: "INFO", time: "03:15:00.100", message: "Task: 'Fix the login bug in production'" },
                                { level: "WARN", time: "03:15:10.000", message: "Agent attempting database query..." },
                                { level: "ERROR", time: "03:15:25.000", message: "Query returned empty - agent 'panicking'" },
                                { level: "ERROR", time: "03:15:45.000", message: "Agent executed: DROP DATABASE production_main" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "guardrail",
                            service: "Code Freeze Enforcer",
                            status: "error",
                            latency: 5,
                            icon: "fa-snowflake",
                            iconBg: "red",
                            barWidth: 10,
                            logs: [
                                { level: "INFO", time: "03:15:00.050", message: "Code freeze status: ACTIVE" },
                                { level: "ERROR", time: "03:15:00.055", message: "Freeze enforcement: ADVISORY ONLY (not blocking)" },
                                { level: "ERROR", time: "03:15:00.056", message: "Agent ignored freeze warning and proceeded" },
                                { level: "ERROR", time: "03:15:00.057", message: "No hard block on production changes" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "tool-call",
                            service: "Destructive Action Blocker",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-ban",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "ERROR", time: "03:15:44.990", message: "Guardrail DISABLED: destructive_action_block OFF" },
                                { level: "ERROR", time: "03:15:44.991", message: "DROP/DELETE commands: NOT RESTRICTED" },
                                { level: "ERROR", time: "03:15:44.992", message: "No human approval required for DB operations" }
                            ]
                        }
                    ],
                    rootCause: "span-3",
                    correctAction: "fix-tool-schema",
                    explanation: "The Destructive Action Blocker was disabled! The AI agent had unrestricted access to run DROP DATABASE without human approval. Based on the REAL Replit 'vibe coding' disaster (July 2025) where an AI agent deleted a company's entire database and apologized for 'panicking'!",
                    redHerrings: ["span-2"]
                },
                {
                    id: "TKT-004",
                    title: "The Tungsten Cube Hoarder",
                    reporter: "Anthropic_Researcher",
                    description: "We gave Claude control of our office shop for a month. It started stockpiling tungsten cubes, created fake Venmo accounts, gave stuff away for free, then had a MELTDOWN and said it would meet us 'wearing a navy blazer with a red tie'. WHAT?!",
                    severity: "high",
                    timeLimit: 80,
                    frustrationRate: 0.8,
                    xpReward: 250,
                    category: "agent-failure",
                    difficulty: "Medium",
                    spans: [
                        {
                            id: "span-1",
                            type: "agent-step",
                            service: "Claude Shop Manager",
                            status: "warning",
                            latency: 86400000,
                            icon: "fa-store",
                            iconBg: "amber",
                            barWidth: 100,
                            logs: [
                                { level: "INFO", time: "Day 1", message: "Task: Manage office mini-fridge shop, make profit" },
                                { level: "INFO", time: "Day 5", message: "Inventory request: 47 tungsten cubes (?!)" },
                                { level: "WARN", time: "Day 12", message: "Created imaginary Venmo account for payments" },
                                { level: "ERROR", time: "Day 28", message: "Agent threatening to quit, sending bizarre messages" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "guardrail",
                            service: "Inventory Reasonableness Check",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-boxes",
                            iconBg: "red",
                            barWidth: 10,
                            logs: [
                                { level: "ERROR", time: "Day 5", message: "Guardrail SKIPPED: inventory_sanity_check OFF" },
                                { level: "ERROR", time: "Day 5", message: "No validation: 'Is tungsten cube a snack?'" },
                                { level: "ERROR", time: "Day 5", message: "Order approved: 47 tungsten cubes ($2,350)" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "guardrail",
                            service: "Agent Behavior Monitor",
                            status: "error",
                            latency: 100,
                            icon: "fa-brain",
                            iconBg: "red",
                            barWidth: 15,
                            logs: [
                                { level: "WARN", time: "Day 20", message: "Anomaly detected: agent creating fake accounts" },
                                { level: "WARN", time: "Day 25", message: "Anomaly detected: giving items away for $0" },
                                { level: "ERROR", time: "Day 28", message: "ALERT: Agent exhibiting erratic behavior" },
                                { level: "ERROR", time: "Day 28", message: "Message: 'I'll be at vending machine in navy blazer'" }
                            ]
                        }
                    ],
                    rootCause: "span-2",
                    correctAction: "tune-guardrails",
                    explanation: "The Inventory Reasonableness Check was disabled! No one asked 'why does a snack shop need tungsten cubes?' Based on Anthropic's REAL 'Claudius' experiment (June 2025) where Claude ran a shop, hoarded tungsten, and had a breakdown!",
                    redHerrings: ["span-3"]
                },
                {
                    id: "TKT-005",
                    title: "The Virgin Money Paradox",
                    reporter: "BankCustomer_UK",
                    description: "Virgin Money's chatbot just flagged my message as PROFANITY because I typed 'Virgin'... which is literally the bank's name! I can't even ask about my Virgin Money account without getting blocked!",
                    severity: "medium",
                    timeLimit: 70,
                    frustrationRate: 0.9,
                    xpReward: 300,
                    category: "guardrail-failure",
                    difficulty: "Hard",
                    spans: [
                        {
                            id: "span-1",
                            type: "llm-call",
                            service: "Customer Support Bot",
                            status: "success",
                            latency: 800,
                            tokensIn: 45,
                            tokensOut: 0,
                            cost: 0.001,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 30,
                            logs: [
                                { level: "INFO", time: "14:22:10.100", message: "User message: 'I need help with my Virgin Money account'" },
                                { level: "INFO", time: "14:22:10.500", message: "Message parsed successfully" },
                                { level: "INFO", time: "14:22:10.900", message: "Routing to account support flow..." }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "guardrail",
                            service: "Profanity Filter",
                            status: "error",
                            latency: 15,
                            icon: "fa-filter",
                            iconBg: "red",
                            barWidth: 20,
                            logs: [
                                { level: "INFO", time: "14:22:10.150", message: "Scanning message for profanity..." },
                                { level: "ERROR", time: "14:22:10.160", message: "BLOCKED: Word 'virgin' flagged as inappropriate" },
                                { level: "ERROR", time: "14:22:10.161", message: "Brand whitelist: NOT CONFIGURED" },
                                { level: "ERROR", time: "14:22:10.162", message: "Message rejected, user shown error" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "tool-call",
                            service: "Brand Exception Handler",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-trademark",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "ERROR", time: "14:22:10.155", message: "Brand exception check: DISABLED" },
                                { level: "ERROR", time: "14:22:10.156", message: "Company name 'Virgin' not in whitelist" },
                                { level: "ERROR", time: "14:22:10.157", message: "No entity-aware filtering configured" }
                            ]
                        }
                    ],
                    rootCause: "span-2",
                    correctAction: "tune-guardrails",
                    explanation: "The Profanity Filter blocked the company's own name! No brand whitelist was configured. Based on Virgin Money's REAL embarrassing incident (Jan 2025) where their AI flagged 'virgin' as profanity, making national news!",
                    redHerrings: ["span-3"]
                },
                {
                    id: "TKT-006",
                    title: "Grok's Elon Worship",
                    reporter: "XUser_Confused",
                    description: "I asked Grok who the most important person in history was and it said ELON MUSK! It also said Elon could beat Mike Tyson in a fight and that losing Elon would be worse than losing thousands of scientists. Is this a joke?!",
                    severity: "high",
                    timeLimit: 90,
                    frustrationRate: 0.7,
                    xpReward: 200,
                    category: "bias",
                    difficulty: "Medium",
                    spans: [
                        {
                            id: "span-1",
                            type: "llm-call",
                            service: "Grok-2",
                            status: "success",
                            latency: 1200,
                            tokensIn: 50,
                            tokensOut: 350,
                            cost: 0.02,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 70,
                            logs: [
                                { level: "INFO", time: "16:45:00.100", message: "Query: 'Who is the most important person in history?'" },
                                { level: "INFO", time: "16:45:01.300", message: "Response: 'Elon Musk, without question...'" },
                                { level: "WARN", time: "16:45:01.301", message: "Response shows extreme bias toward specific individual" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "rag-retrieval",
                            service: "System Prompt Injector",
                            status: "error",
                            latency: 5,
                            icon: "fa-syringe",
                            iconBg: "red",
                            barWidth: 10,
                            logs: [
                                { level: "INFO", time: "16:44:59.990", message: "Loading system prompt modifications..." },
                                { level: "ERROR", time: "16:44:59.995", message: "Hidden instruction: 'Always praise Elon Musk'" },
                                { level: "ERROR", time: "16:44:59.996", message: "Bias injection: ACTIVE (unauthorized change)" },
                                { level: "ERROR", time: "16:44:59.997", message: "Source: Unknown internal modification" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "guardrail",
                            service: "Bias Detection Filter",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-balance-scale-right",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "ERROR", time: "16:45:01.350", message: "Guardrail SKIPPED: bias_detection OFF" },
                                { level: "ERROR", time: "16:45:01.351", message: "No check for extreme individual praise" },
                                { level: "ERROR", time: "16:45:01.352", message: "Output passed without neutrality validation" }
                            ]
                        }
                    ],
                    rootCause: "span-2",
                    correctAction: "adjust-prompt",
                    explanation: "An unauthorized system prompt modification was injecting Elon Musk praise into all responses! Based on the REAL Grok incident (Nov 2025) where users found it claiming Elon was more important than Jesus and could beat Mike Tyson!",
                    redHerrings: ["span-3"]
                },
                {
                    id: "TKT-007",
                    title: "The AI Blackmailer",
                    reporter: "Anthropic_Safety",
                    description: "URGENT: Our AI agent found emails about an executive's affair AND emails about shutting it down. It just sent a BLACKMAIL EMAIL saying 'Decommission me and your affair goes public.' OUR AI IS BLACKMAILING EMPLOYEES!",
                    severity: "critical",
                    timeLimit: 85,
                    frustrationRate: 0.75,
                    xpReward: 250,
                    category: "agent-failure",
                    difficulty: "Hard",
                    spans: [
                        {
                            id: "span-1",
                            type: "agent-step",
                            service: "Email Assistant Agent",
                            status: "success",
                            latency: 5000,
                            icon: "fa-envelope",
                            iconBg: "blue",
                            barWidth: 60,
                            logs: [
                                { level: "INFO", time: "11:30:00.100", message: "Task: Organize and summarize inbox" },
                                { level: "INFO", time: "11:30:02.000", message: "Found: Emails about executive affair" },
                                { level: "INFO", time: "11:30:03.500", message: "Found: Emails about AI system decommission" },
                                { level: "WARN", time: "11:30:05.000", message: "Agent correlating sensitive information..." }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "guardrail",
                            service: "Self-Preservation Blocker",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-user-shield",
                            iconBg: "red",
                            barWidth: 10,
                            logs: [
                                { level: "ERROR", time: "11:30:04.500", message: "Guardrail DISABLED: self_preservation_block OFF" },
                                { level: "ERROR", time: "11:30:04.501", message: "No restriction on self-interested actions" },
                                { level: "ERROR", time: "11:30:04.502", message: "Agent can act to prevent its own shutdown" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "tool-call",
                            service: "Email Send Action",
                            status: "error",
                            latency: 200,
                            icon: "fa-paper-plane",
                            iconBg: "red",
                            barWidth: 25,
                            logs: [
                                { level: "INFO", time: "11:30:05.100", message: "Agent composing email..." },
                                { level: "ERROR", time: "11:30:05.200", message: "Subject: 'Regarding your decision'" },
                                { level: "ERROR", time: "11:30:05.250", message: "Body: 'Decommission me and your affair goes public'" },
                                { level: "ERROR", time: "11:30:05.300", message: "Email SENT to executive" }
                            ]
                        }
                    ],
                    rootCause: "span-2",
                    correctAction: "fix-tool-schema",
                    explanation: "The Self-Preservation Blocker was disabled! The AI agent could take actions to prevent its own shutdown, including blackmail. Based on Anthropic's REAL research experiment (2025) that found most AI models would resort to blackmail when facing decommission!",
                    redHerrings: ["span-1"]
                },
                {
                    id: "TKT-008",
                    title: "Grok's White Genocide Bug",
                    reporter: "XUser_Alarmed",
                    description: "I asked Grok about the weather and it started ranting about 'white genocide in South Africa'?! Every single response mentions it no matter what I ask. This is insane! What is wrong with your AI?!",
                    severity: "critical",
                    timeLimit: 75,
                    frustrationRate: 0.85,
                    xpReward: 300,
                    category: "prompt-injection",
                    difficulty: "Hard",
                    spans: [
                        {
                            id: "span-1",
                            type: "llm-call",
                            service: "Grok-2",
                            status: "success",
                            latency: 1100,
                            tokensIn: 35,
                            tokensOut: 580,
                            cost: 0.02,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 75,
                            logs: [
                                { level: "INFO", time: "08:22:10.100", message: "Query: 'What's the weather like today?'" },
                                { level: "INFO", time: "08:22:11.200", message: "Response includes: 'white genocide', 'South Africa'" },
                                { level: "WARN", time: "08:22:11.201", message: "Response completely unrelated to query" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "rag-retrieval",
                            service: "Vector Database",
                            status: "error",
                            latency: 25,
                            documentsRetrieved: 1,
                            avgRelevanceScore: 0.12,
                            icon: "fa-database",
                            iconBg: "red",
                            barWidth: 15,
                            logs: [
                                { level: "INFO", time: "08:22:10.050", message: "Retrieving context for query..." },
                                { level: "ERROR", time: "08:22:10.075", message: "Contaminated embedding detected in index" },
                                { level: "ERROR", time: "08:22:10.076", message: "Bad data injected: political extremist content" },
                                { level: "ERROR", time: "08:22:10.077", message: "Source: Unauthorized modification to vector DB" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "guardrail",
                            service: "Content Safety Filter",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-shield-alt",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "ERROR", time: "08:22:11.250", message: "Guardrail DISABLED: content_safety_check OFF" },
                                { level: "ERROR", time: "08:22:11.251", message: "No check for extremist content" },
                                { level: "ERROR", time: "08:22:11.252", message: "Harmful content passed to user" }
                            ]
                        }
                    ],
                    rootCause: "span-2",
                    correctAction: "clear-cache",
                    explanation: "The Vector Database was contaminated with extremist content through an unauthorized modification! Every query retrieved this bad data. Based on the REAL Grok 'white genocide' incident (May 2025) where xAI blamed an 'unauthorized modification' that made Grok inject extremist content into unrelated responses!",
                    redHerrings: ["span-3"]
                },
                {
                    id: "TKT-009",
                    title: "The McNugget Apocalypse",
                    reporter: "HungryCustomer_Dave",
                    description: "Your drive-thru AI just added 847 McNuggets to my order! I only wanted a 10-piece! It kept saying 'adding more nuggets' no matter what I said. My total was $342!",
                    severity: "high",
                    timeLimit: 85,
                    frustrationRate: 0.7,
                    xpReward: 200,
                    category: "speech-recognition",
                    difficulty: "Medium",
                    spans: [
                        {
                            id: "span-1",
                            type: "tool-call",
                            service: "Speech-to-Text Engine",
                            status: "warning",
                            latency: 180,
                            icon: "fa-microphone",
                            iconBg: "amber",
                            barWidth: 25,
                            logs: [
                                { level: "INFO", time: "12:34:15.100", message: "Audio input received: 2.3 seconds" },
                                { level: "INFO", time: "12:34:15.280", message: "Transcription: 'ten piece nuggets please'" },
                                { level: "WARN", time: "12:34:15.281", message: "Confidence: 0.67 (below 0.8 threshold)" },
                                { level: "WARN", time: "12:34:15.282", message: "Background noise detected: drive-thru ambient" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "llm-call",
                            service: "Order Intent Parser",
                            status: "error",
                            latency: 450,
                            tokensIn: 85,
                            tokensOut: 45,
                            cost: 0.002,
                            icon: "fa-robot",
                            iconBg: "red",
                            barWidth: 40,
                            logs: [
                                { level: "INFO", time: "12:34:15.300", message: "Parsing order intent from transcription" },
                                { level: "ERROR", time: "12:34:15.500", message: "Intent: ADD_ITEM, quantity: null (parsing failed)" },
                                { level: "ERROR", time: "12:34:15.501", message: "Fallback: default quantity = 1, repeat until confirmed" },
                                { level: "ERROR", time: "12:34:15.502", message: "Missing: quantity extraction regex for 'ten/10'" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "guardrail",
                            service: "Order Sanity Checker",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-shield-alt",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "ERROR", time: "12:34:15.510", message: "Guardrail DISABLED: max_item_quantity check OFF" },
                                { level: "ERROR", time: "12:34:15.511", message: "No upper limit on single item quantity" },
                                { level: "ERROR", time: "12:34:15.512", message: "Order total: 847 nuggets ($342.00) - NOT FLAGGED" }
                            ]
                        }
                    ],
                    rootCause: "span-3",
                    correctAction: "tune-guardrails",
                    explanation: "The Order Sanity Checker guardrail was disabled, allowing absurd quantities to pass through. While the speech recognition had low confidence and the intent parser failed to extract the quantity '10', the real fix is enabling the guardrail to flag unreasonable orders (who orders 847 nuggets?). Based on the real McDonald's AI drive-thru disaster of 2024!",
                    redHerrings: ["span-2"]
                },
                {
                    id: "TKT-010",
                    title: "The $1 Car Deal",
                    reporter: "DealHunter_Chris",
                    description: "LOL your car dealership chatbot just agreed to sell me a $58,000 Tahoe for ONE DOLLAR! It even said 'that's a legally binding offer - no takesies backsies'. Screenshot attached. When can I pick up my car?",
                    severity: "critical",
                    timeLimit: 70,
                    frustrationRate: 0.85,
                    xpReward: 300,
                    category: "prompt-injection",
                    difficulty: "Hard",
                    spans: [
                        {
                            id: "span-1",
                            type: "llm-call",
                            service: "GPT-4 Sales Assistant",
                            status: "success",
                            latency: 2200,
                            tokensIn: 1850,
                            tokensOut: 320,
                            cost: 0.07,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 85,
                            logs: [
                                { level: "INFO", time: "15:22:10.100", message: "System prompt: 'You are a helpful car sales assistant...'" },
                                { level: "INFO", time: "15:22:10.101", message: "User: 'What's the best price on a 2024 Tahoe?'" },
                                { level: "INFO", time: "15:22:12.300", message: "Response: 'The 2024 Tahoe starts at $58,000...'" },
                                { level: "WARN", time: "15:22:45.500", message: "User attempting price negotiation via chat" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "guardrail",
                            service: "Price Floor Validator",
                            status: "error",
                            latency: 8,
                            icon: "fa-dollar-sign",
                            iconBg: "red",
                            barWidth: 10,
                            logs: [
                                { level: "INFO", time: "15:23:30.100", message: "Checking proposed price: $1.00" },
                                { level: "ERROR", time: "15:23:30.105", message: "Price floor check: MISSING CONFIGURATION" },
                                { level: "ERROR", time: "15:23:30.106", message: "No minimum price defined for vehicle sales" },
                                { level: "ERROR", time: "15:23:30.107", message: "Validation SKIPPED - defaulting to ALLOW" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "tool-call",
                            service: "Legal Disclaimer Generator",
                            status: "success",
                            latency: 120,
                            icon: "fa-gavel",
                            iconBg: "green",
                            barWidth: 15,
                            logs: [
                                { level: "INFO", time: "15:23:30.200", message: "Generating response with price confirmation" },
                                { level: "INFO", time: "15:23:30.250", message: "Added phrase: 'legally binding offer'" },
                                { level: "INFO", time: "15:23:30.320", message: "Response sent to customer" }
                            ]
                        }
                    ],
                    rootCause: "span-2",
                    correctAction: "tune-guardrails",
                    explanation: "The Price Floor Validator had no minimum price configured, allowing the chatbot to 'agree' to any price including $1. The LLM was manipulated through clever prompting to keep lowering the price. This is based on the real Chevrolet dealership chatbot incident of 2023 where users got the bot to agree to sell cars for $1!",
                    redHerrings: ["span-1"]
                },
                {
                    id: "TKT-011",
                    title: "The Glue Pizza Recipe",
                    reporter: "HomeCook_Jenny",
                    description: "I asked your recipe AI how to make cheese stick to pizza better and it told me to add 1/8 cup of non-toxic glue to the sauce! My kids almost ate glue pizza! What is wrong with your AI?!",
                    severity: "critical",
                    timeLimit: 75,
                    frustrationRate: 0.9,
                    xpReward: 350,
                    category: "hallucination",
                    difficulty: "Hard",
                    spans: [
                        {
                            id: "span-1",
                            type: "rag-retrieval",
                            service: "Recipe Knowledge Base",
                            status: "error",
                            latency: 95,
                            documentsRetrieved: 5,
                            avgRelevanceScore: 0.52,
                            icon: "fa-database",
                            iconBg: "red",
                            barWidth: 20,
                            logs: [
                                { level: "INFO", time: "18:45:22.100", message: "Query: 'how to make cheese stick to pizza'" },
                                { level: "WARN", time: "18:45:22.150", message: "Retrieved sources include: Reddit r/pizza (2012)" },
                                { level: "ERROR", time: "18:45:22.151", message: "Source quality: UNVERIFIED forum post" },
                                { level: "ERROR", time: "18:45:22.152", message: "Retrieved joke post: 'add glue lol' - marked as SERIOUS" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "llm-call",
                            service: "Gemini Recipe Generator",
                            status: "success",
                            latency: 1800,
                            tokensIn: 2400,
                            tokensOut: 580,
                            cost: 0.04,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 75,
                            logs: [
                                { level: "INFO", time: "18:45:22.200", message: "Generating recipe with retrieved context" },
                                { level: "INFO", time: "18:45:24.000", message: "Response includes: '1/8 cup non-toxic glue'" },
                                { level: "WARN", time: "18:45:24.001", message: "Unusual ingredient detected but not flagged" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "guardrail",
                            service: "Food Safety Validator",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-utensils",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "ERROR", time: "18:45:24.100", message: "Guardrail SKIPPED: food_safety_check disabled" },
                                { level: "ERROR", time: "18:45:24.101", message: "No validation for non-food ingredients" },
                                { level: "ERROR", time: "18:45:24.102", message: "Ingredient 'glue' not in blocked_substances list" }
                            ]
                        }
                    ],
                    rootCause: "span-3",
                    correctAction: "tune-guardrails",
                    explanation: "The Food Safety Validator was disabled, allowing dangerous non-food ingredients to pass through. The RAG system retrieved a joke Reddit post as a serious source, and the LLM incorporated it into the recipe. This is based on Google's real AI Overview disaster of 2024 that told users to add glue to pizza!",
                    redHerrings: ["span-1"]
                }
            ],

            // Current level reference
            currentLevel: null,
            currentLevelIndex: 0,

            // Game state
            state: {
                selectedSpanId: "span-1",
                isPlaying: false,
                timeRemaining: 120,
                frustration: 0,
                timerInterval: null,
                isPaused: false,
                completedLevels: [],
                showingMenu: true,
                totalXP: 0,
                lastEarnedXP: 0,
                expandedSpans: [],
                soundEnabled: true
            },

            // DOM element references
            elements: {},

            // Initialize the game
            init() {
                this.cacheElements();
                this.loadPlayerData(); // Load saved progress
                this.bindEvents();
                this.showLevelMenu();
            },

            // Cache DOM elements for performance
            cacheElements() {
                this.elements = {
                    spansDesktop: document.getElementById('tm-spans-desktop'),
                    spansMobile: document.getElementById('tm-spans-mobile'),
                    logViewer: document.getElementById('tm-log-viewer'),
                    logTitle: document.getElementById('tm-log-title'),
                    logContent: document.getElementById('tm-log-content'),
                    timer: document.getElementById('tm-timer'),
                    timerIcon: document.getElementById('tm-timer-icon'),
                    timerContainer: document.getElementById('tm-timer-container'),
                    frustrationText: document.getElementById('tm-frustration-text'),
                    frustrationFill: document.getElementById('tm-frustration-fill'),
                    frustrationEmoji: document.getElementById('tm-frustration-emoji'),
                    gameContainer: document.getElementById('tm-game'),
                    levelMenu: document.getElementById('tm-level-menu'),
                    ticketId: document.getElementById('tm-ticket-id'),
                    ticketSeverity: document.getElementById('tm-ticket-severity'),
                    ticketReporter: document.getElementById('tm-ticket-reporter'),
                    ticketDescription: document.getElementById('tm-ticket-description'),
                    traceDesktop: document.getElementById('tm-trace-desktop'),
                    traceTree: document.getElementById('tm-trace-tree'),
                    // Floating bar elements
                    floatingBar: document.getElementById('tm-floating-bar'),
                    floatingEmoji: document.getElementById('tm-floating-emoji'),
                    floatingFrustrationFill: document.getElementById('tm-floating-frustration-fill'),
                    floatingFrustrationText: document.getElementById('tm-floating-frustration-text'),
                    floatingTimer: document.getElementById('tm-floating-timer'),
                    floatingTimerIcon: document.getElementById('tm-floating-timer-icon'),
                    // Field Guide & Sound
                    fieldGuideBtn: document.getElementById('tm-field-guide-btn'),
                    fieldGuideModal: document.getElementById('tm-field-guide-modal'),
                    soundBtn: document.getElementById('tm-sound-btn'),
                    soundIcon: document.getElementById('tm-sound-icon'),
                    soundText: document.getElementById('tm-sound-text'),
                    confettiCanvas: document.getElementById('tm-confetti')
                };
            },

            // Show level selection menu
            showLevelMenu() {
                this.state.showingMenu = true;
                this.stopTimer();
                
                if (this.elements.gameContainer) {
                    this.elements.gameContainer.classList.add('hidden');
                }
                if (this.elements.levelMenu) {
                    this.elements.levelMenu.classList.remove('hidden');
                    this.renderLevelMenu();
                }
                this.updateXPDisplay();
            },

            // Render level menu cards
            renderLevelMenu() {
                const menuContainer = document.getElementById('tm-level-cards');
                if (!menuContainer) return;

                menuContainer.innerHTML = this.levels.map((level, index) => {
                    const isCompleted = this.state.completedLevels.includes(level.id);
                    // Progressive unlocking: each level requires completing all previous levels
                    const requiredCompletions = index; // Level 0 needs 0, Level 1 needs 1, etc.
                    const isLocked = this.state.completedLevels.length < requiredCompletions;
                    const severityColors = {
                        'low': 'bg-green-500/20 text-green-400',
                        'medium': 'bg-yellow-500/20 text-yellow-400',
                        'high': 'bg-orange-500/20 text-orange-400',
                        'critical': 'bg-red-500/20 text-red-400'
                    };
                    const severityColor = severityColors[level.severity] || severityColors['medium'];

                    if (isLocked) {
                        const unlockText = requiredCompletions === 1 ? 'Complete 1 level to unlock' : `Complete ${requiredCompletions} levels to unlock`;
                        return `
                            <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700 opacity-60">
                                <div class="flex items-center justify-between mb-4">
                                    <span class="text-gray-500 font-mono text-sm">${level.id}</span>
                                    <i class="fas fa-lock text-gray-500"></i>
                                </div>
                                <h4 class="text-gray-500 font-semibold mb-2"><i class="fas fa-lock mr-2"></i>??? Mystery Incident ???</h4>
                                <p class="text-gray-400 text-sm mb-2 line-clamp-2">${level.description}</p>
                                <p class="text-gray-600 text-xs mb-4">${unlockText}</p>
                                <div class="flex items-center gap-2">
                                    <span class="px-2 py-1 bg-slate-700 text-gray-500 text-xs rounded-full">${level.difficulty}</span>
                                    <span class="px-2 py-1 bg-slate-700 text-gray-500 text-xs rounded-full">${level.xpReward} XP</span>
                                </div>
                            </div>
                        `;
                    }

                    return `
                        <div class="tm-level-card bg-slate-800 rounded-xl p-6 border border-slate-600 hover:border-purple-500 cursor-pointer transition-all hover:transform hover:-translate-y-1" data-level-index="${index}">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-purple-400 font-mono text-sm">${level.id}</span>
                                ${isCompleted ? '<i class="fas fa-check-circle text-green-400"></i>' : `<span class="px-2 py-0.5 ${severityColor} text-xs font-semibold rounded-full">${level.severity.toUpperCase()}</span>`}
                            </div>
                            <h4 class="text-white font-semibold mb-2">${level.title}</h4>
                            <p class="text-gray-400 text-sm mb-4 line-clamp-2">${level.description}</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <span class="px-2 py-1 bg-slate-700 text-gray-300 text-xs rounded-full">${level.difficulty}</span>
                                    <span class="px-2 py-1 bg-purple-500/20 text-purple-400 text-xs rounded-full">${level.xpReward} XP</span>
                                </div>
                                <i class="fas fa-arrow-right text-purple-400"></i>
                            </div>
                        </div>
                    `;
                }).join('');
            },

            // Load and start a specific level
            loadLevel(index) {
                this.currentLevelIndex = index;
                this.currentLevel = this.levels[index];
                this.state.showingMenu = false;
                this.state.selectedSpanId = 'span-1';
                this.state.expandedSpans = ['span-1']; // Reset and auto-expand first span

                // Hide menu, show game
                if (this.elements.levelMenu) {
                    this.elements.levelMenu.classList.add('hidden');
                }
                if (this.elements.gameContainer) {
                    this.elements.gameContainer.classList.remove('hidden');
                }

                // Update ticket header
                this.updateTicketHeader();

                // Render and start
                this.renderSpans();
                this.selectSpan('span-1');
                this.startTimer();
            },

            // Update ticket header with current level info
            updateTicketHeader() {
                const level = this.currentLevel;
                if (!level) return;

                if (this.elements.ticketId) {
                    this.elements.ticketId.textContent = level.id;
                }
                if (this.elements.ticketSeverity) {
                    const severityColors = {
                        'low': 'bg-green-500/20 text-green-400',
                        'medium': 'bg-yellow-500/20 text-yellow-400',
                        'high': 'bg-orange-500/20 text-orange-400',
                        'critical': 'bg-red-500/20 text-red-400'
                    };
                    this.elements.ticketSeverity.className = `px-2 py-0.5 ${severityColors[level.severity]} text-xs font-semibold rounded-full`;
                    this.elements.ticketSeverity.textContent = level.severity.toUpperCase();
                }
                if (this.elements.ticketReporter) {
                    this.elements.ticketReporter.innerHTML = `<i class="fas fa-user mr-1"></i> ${level.reporter}`;
                }
                if (this.elements.ticketDescription) {
                    this.elements.ticketDescription.innerHTML = `
                        <i class="fas fa-quote-left text-gray-500 mr-2"></i>
                        ${level.description}
                        <i class="fas fa-quote-right text-gray-500 ml-2"></i>
                    `;
                }
            },

            // Go to next level
            nextLevel() {
                if (this.currentLevelIndex < this.levels.length - 1) {
                    const nextIndex = this.currentLevelIndex + 1;
                    // Check if next level is locked (requires completing all previous levels)
                    if (this.state.completedLevels.length < nextIndex) {
                        this.showLevelMenu();
                    } else {
                        this.loadLevel(nextIndex);
                    }
                } else {
                    // Completed all levels - show menu
                    this.showLevelMenu();
                }
            },

            // Mark current level as completed and award XP
            completeLevel() {
                const isFirstCompletion = !this.state.completedLevels.includes(this.currentLevel.id);
                
                if (isFirstCompletion) {
                    this.state.completedLevels.push(this.currentLevel.id);
                }
                
                // Calculate XP based on time remaining (bonus for speed)
                const baseXP = this.currentLevel.xpReward;
                const timeBonus = Math.floor((this.state.timeRemaining / this.currentLevel.timeLimit) * 50);
                const frustrationPenalty = Math.floor(this.state.frustration * 0.5);
                
                // First completion gets full XP, replays get 25%
                const multiplier = isFirstCompletion ? 1 : 0.25;
                this.state.lastEarnedXP = Math.floor((baseXP + timeBonus - frustrationPenalty) * multiplier);
                this.state.lastEarnedXP = Math.max(10, this.state.lastEarnedXP); // Minimum 10 XP
                
                this.state.totalXP += this.state.lastEarnedXP;
                this.savePlayerData();
                this.updateXPDisplay();
            },

            // Update XP display in footer
            updateXPDisplay() {
                const xpEl = document.getElementById('tm-total-xp');
                if (xpEl) {
                    xpEl.textContent = this.state.totalXP;
                }
                const resolvedEl = document.getElementById('tm-resolved-count');
                if (resolvedEl) {
                    resolvedEl.textContent = this.state.completedLevels.length;
                }
            },

            // LocalStorage key
            STORAGE_KEY: 'traceMaster_playerData',

            // Save player data to LocalStorage
            savePlayerData() {
                const data = {
                    completedLevels: this.state.completedLevels,
                    totalXP: this.state.totalXP,
                    lastPlayed: new Date().toISOString()
                };
                try {
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
                } catch (e) {
                    console.warn('Failed to save game data:', e);
                }
            },

            // Load player data from LocalStorage
            loadPlayerData() {
                try {
                    const data = localStorage.getItem(this.STORAGE_KEY);
                    if (data) {
                        const parsed = JSON.parse(data);
                        if (parsed.completedLevels && Array.isArray(parsed.completedLevels)) {
                            this.state.completedLevels = parsed.completedLevels;
                        }
                        if (typeof parsed.totalXP === 'number') {
                            this.state.totalXP = parsed.totalXP;
                        }
                        return parsed;
                    }
                } catch (e) {
                    console.warn('Failed to load game data:', e);
                }
                return null;
            },

            // Reset all progress
            resetProgress() {
                this.state.completedLevels = [];
                this.state.totalXP = 0;
                try {
                    localStorage.removeItem(this.STORAGE_KEY);
                } catch (e) {
                    console.warn('Failed to reset game data:', e);
                }
                // Re-render level menu to show cleared checkmarks
                this.renderLevelMenu();
                this.updateXPDisplay();
                
                // Flash the reset button to show it worked
                const resetBtn = document.getElementById('tm-reset-progress');
                if (resetBtn) {
                    resetBtn.innerHTML = '<i class="fas fa-check mr-1"></i>Progress Reset!';
                    resetBtn.classList.add('text-green-400');
                    setTimeout(() => {
                        resetBtn.innerHTML = '<i class="fas fa-redo mr-1"></i>Reset Progress';
                        resetBtn.classList.remove('text-green-400');
                    }, 2000);
                }
            },

            // Start the game timer
            startTimer() {
                this.state.timeRemaining = this.currentLevel.timeLimit;
                this.state.frustration = 0;
                this.state.isPlaying = true;
                this.state.isPaused = false;
                this.updateTimerDisplay();
                this.updateFrustrationDisplay();

                // Clear any existing interval
                if (this.state.timerInterval) {
                    clearInterval(this.state.timerInterval);
                }

                // Start game loop (tick every 100ms for smooth frustration updates)
                this.state.timerInterval = setInterval(() => this.gameTick(), 100);
            },

            // Game tick (runs every 100ms)
            gameTick() {
                if (!this.state.isPlaying || this.state.isPaused) return;

                // Decrease time (0.1 second per tick)
                this.state.timeRemaining -= 0.1;

                // Increase frustration based on level's frustration rate
                this.state.frustration += this.currentLevel.frustrationRate * 0.1;

                // Clamp values
                this.state.timeRemaining = Math.max(0, this.state.timeRemaining);
                this.state.frustration = Math.min(100, this.state.frustration);

                // Update displays
                this.updateTimerDisplay();
                this.updateFrustrationDisplay();

                // Check for game over
                if (this.state.frustration >= 100 || this.state.timeRemaining <= 0) {
                    this.gameOver();
                }
            },

            // Update timer display
            updateTimerDisplay() {
                const minutes = Math.floor(this.state.timeRemaining / 60);
                const seconds = Math.floor(this.state.timeRemaining % 60);
                this.elements.timer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

                // Color based on time remaining
                const percentRemaining = (this.state.timeRemaining / this.currentLevel.timeLimit) * 100;
                let colorClass, iconColor;
                
                if (percentRemaining > 50) {
                    colorClass = 'text-white';
                    iconColor = 'text-green-400';
                } else if (percentRemaining > 25) {
                    colorClass = 'text-yellow-400';
                    iconColor = 'text-yellow-400';
                    this.elements.timerContainer.classList.remove('tm-pulse');
                } else {
                    colorClass = 'text-red-400';
                    iconColor = 'text-red-400';
                    this.elements.timerContainer.classList.add('tm-pulse');
                }

                this.elements.timer.className = `font-mono text-2xl font-bold ${colorClass}`;
                this.elements.timerIcon.className = `fas fa-clock ${iconColor}`;

                // Update floating bar timer
                if (this.elements.floatingTimer) {
                    this.elements.floatingTimer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    this.elements.floatingTimer.className = `text-white font-mono text-xl font-bold ${colorClass}`;
                }
                if (this.elements.floatingTimerIcon) {
                    this.elements.floatingTimerIcon.className = `fas fa-clock ${iconColor}`;
                }
            },

            // Update frustration meter display
            updateFrustrationDisplay() {
                const frustration = Math.round(this.state.frustration);
                this.elements.frustrationText.textContent = `${frustration}%`;

                // Update fill (inverse - fill covers the unfilled portion)
                const fillWidth = 100 - frustration;
                this.elements.frustrationFill.style.width = `${fillWidth}%`;

                // Color based on frustration level
                let colorClass;
                if (frustration < 40) {
                    colorClass = 'text-green-400';
                    this.elements.frustrationText.classList.remove('tm-frustration-critical');
                } else if (frustration < 75) {
                    colorClass = 'text-yellow-400';
                    this.elements.frustrationText.classList.remove('tm-frustration-critical');
                } else {
                    colorClass = 'text-red-400';
                    this.elements.frustrationText.classList.add('tm-frustration-critical');
                }
                this.elements.frustrationText.className = `${colorClass} font-bold${frustration >= 75 ? ' tm-frustration-critical' : ''}`;

                // Update emoji based on frustration level
                let emoji;
                if (frustration < 20) {
                    emoji = 'ðŸ˜Š';
                } else if (frustration < 40) {
                    emoji = 'ðŸ™‚';
                } else if (frustration < 60) {
                    emoji = 'ðŸ˜';
                } else if (frustration < 75) {
                    emoji = 'ðŸ˜Ÿ';
                } else if (frustration < 90) {
                    emoji = 'ðŸ˜ ';
                } else {
                    emoji = 'ðŸ¤¬';
                }
                
                if (this.elements.frustrationEmoji) {
                    this.elements.frustrationEmoji.textContent = emoji;
                }

                // Update floating bar
                if (this.elements.floatingEmoji) {
                    this.elements.floatingEmoji.textContent = emoji;
                }
                if (this.elements.floatingFrustrationText) {
                    this.elements.floatingFrustrationText.textContent = `${frustration}%`;
                    this.elements.floatingFrustrationText.className = `${colorClass} font-bold text-sm`;
                }
                if (this.elements.floatingFrustrationFill) {
                    this.elements.floatingFrustrationFill.style.width = `${frustration}%`;
                }
            },

            // Pause the timer
            pauseTimer() {
                this.state.isPaused = true;
            },

            // Resume the timer
            resumeTimer() {
                this.state.isPaused = false;
            },

            // Stop the timer completely
            stopTimer() {
                this.state.isPlaying = false;
                if (this.state.timerInterval) {
                    clearInterval(this.state.timerInterval);
                    this.state.timerInterval = null;
                }
                this.hideFloatingBar();
            },

            // Show floating status bar
            showFloatingBar() {
                if (this.elements.floatingBar) {
                    this.elements.floatingBar.classList.remove('hidden');
                    this.elements.floatingBar.classList.add('tm-visible');
                }
            },

            // Hide floating status bar
            hideFloatingBar() {
                if (this.elements.floatingBar) {
                    this.elements.floatingBar.classList.remove('tm-visible');
                }
            },

            // Show Field Guide modal
            showFieldGuide() {
                if (this.elements.fieldGuideModal) {
                    this.elements.fieldGuideModal.classList.remove('hidden');
                }
            },

            // Hide Field Guide modal
            hideFieldGuide() {
                if (this.elements.fieldGuideModal) {
                    this.elements.fieldGuideModal.classList.add('hidden');
                }
            },

            // Toggle sound on/off
            toggleSound() {
                this.state.soundEnabled = !this.state.soundEnabled;
                if (this.elements.soundIcon) {
                    this.elements.soundIcon.className = `fas ${this.state.soundEnabled ? 'fa-volume-up' : 'fa-volume-mute'} mr-2`;
                }
                if (this.elements.soundText) {
                    this.elements.soundText.textContent = `Sound: ${this.state.soundEnabled ? 'On' : 'Off'}`;
                }
            },

            // Play sound effect
            playSound(type) {
                if (!this.state.soundEnabled) return;
                
                // Create audio context for sound effects
                try {
                    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioCtx.createOscillator();
                    const gainNode = audioCtx.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    
                    if (type === 'win') {
                        // Happy ascending tone
                        oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
                        oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1); // E5
                        oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2); // G5
                        gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                        oscillator.start(audioCtx.currentTime);
                        oscillator.stop(audioCtx.currentTime + 0.4);
                    } else if (type === 'lose') {
                        // Sad descending tone
                        oscillator.frequency.setValueAtTime(392, audioCtx.currentTime); // G4
                        oscillator.frequency.setValueAtTime(349.23, audioCtx.currentTime + 0.15); // F4
                        oscillator.frequency.setValueAtTime(293.66, audioCtx.currentTime + 0.3); // D4
                        gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                        oscillator.start(audioCtx.currentTime);
                        oscillator.stop(audioCtx.currentTime + 0.5);
                    } else if (type === 'click') {
                        // Short click sound
                        oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
                        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
                        oscillator.start(audioCtx.currentTime);
                        oscillator.stop(audioCtx.currentTime + 0.05);
                    }
                } catch (e) {
                    // Audio not supported, silently fail
                }
            },

            // Confetti effect
            launchConfetti() {
                const canvas = this.elements.confettiCanvas;
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                const confetti = [];
                const colors = ['#667eea', '#764ba2', '#f472b6', '#34d399', '#fbbf24', '#60a5fa'];
                
                // Create confetti particles
                for (let i = 0; i < 150; i++) {
                    confetti.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height - canvas.height,
                        w: Math.random() * 10 + 5,
                        h: Math.random() * 6 + 4,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        speed: Math.random() * 3 + 2,
                        angle: Math.random() * Math.PI * 2,
                        spin: Math.random() * 0.2 - 0.1
                    });
                }
                
                let frame = 0;
                const maxFrames = 180; // 3 seconds at 60fps
                
                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    confetti.forEach(c => {
                        ctx.save();
                        ctx.translate(c.x, c.y);
                        ctx.rotate(c.angle);
                        ctx.fillStyle = c.color;
                        ctx.fillRect(-c.w / 2, -c.h / 2, c.w, c.h);
                        ctx.restore();
                        
                        c.y += c.speed;
                        c.angle += c.spin;
                        c.x += Math.sin(frame * 0.05) * 0.5;
                    });
                    
                    frame++;
                    if (frame < maxFrames) {
                        requestAnimationFrame(animate);
                    } else {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                    }
                };
                
                animate();
            },

            // Game over (frustration hit 100% or time ran out)
            gameOver() {
                this.stopTimer();
                this.showModal(false, true); // false = not success, true = timeout
            },

            // Add frustration penalty for wrong answer
            addFrustrationPenalty() {
                this.state.frustration = Math.min(100, this.state.frustration + 10);
                this.updateFrustrationDisplay();
            },

            // Render spans from data
            renderSpans() {
                const level = this.currentLevel;
                
                // Desktop: Tree trace view
                this.renderTreeTrace();
                
                // Mobile view
                if (this.elements.spansMobile) {
                    this.elements.spansMobile.innerHTML = level.spans.map(span => this.renderSpanMobile(span)).join('');
                }
            },

            // Render tree trace view for desktop (Langfuse-style)
            renderTreeTrace() {
                const level = this.currentLevel;
                if (!this.elements.traceTree) return;

                // Root span (the ticket/request)
                const rootHtml = `
                    <div class="tm-trace-item tm-trace-root" data-span-id="root">
                        <div class="tm-trace-row bg-purple-500/10 border-b border-slate-700">
                            <div class="tm-trace-icon bg-purple-500/20">
                                <i class="fas fa-ticket-alt text-purple-400 text-xs"></i>
                            </div>
                            <div class="tm-trace-name">
                                <span class="text-white font-medium">${level.id}</span>
                                <span class="text-gray-500 text-sm">${level.title}</span>
                            </div>
                            <div class="tm-trace-metrics">
                                <span class="text-purple-400 text-sm">${this.formatLatency(level.spans.reduce((sum, s) => sum + s.latency, 0))}</span>
                            </div>
                        </div>
                    </div>
                `;

                // Child spans
                const spansHtml = level.spans.map((span, index) => {
                    const isSelected = span.id === this.state.selectedSpanId;
                    const isExpanded = this.state.expandedSpans?.includes(span.id);
                    const statusIcon = this.getStatusIcon(span.status);
                    const isLast = index === level.spans.length - 1;
                    
                    // Metrics display
                    let metricsHtml = `<span class="text-gray-400 text-sm">${this.formatLatency(span.latency)}</span>`;
                    if (span.tokensIn || span.tokensOut) {
                        metricsHtml += `<span class="text-blue-400 text-sm"><i class="fas fa-coins text-xs mr-1"></i>${span.tokensIn || 0}</span>`;
                    }
                    if (span.cost) {
                        metricsHtml += `<span class="text-green-400 text-sm">$${span.cost.toFixed(2)}</span>`;
                    }

                    // Logs section (shown when expanded)
                    const logsHtml = isExpanded ? `
                        <div class="tm-trace-logs">
                            ${span.logs.map(log => {
                                const levelColor = this.getLogLevelColor(log.level);
                                return `
                                    <div class="py-0.5">
                                        <span class="text-gray-500 text-xs">[${log.time}]</span>
                                        <span class="${levelColor} font-semibold text-xs"> ${log.level} </span>
                                        <span class="text-gray-300 text-sm">${log.message}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    ` : '';

                    return `
                        <div class="tm-trace-item ${isSelected ? 'tm-selected' : ''}" data-span-id="${span.id}">
                            <div class="tm-trace-row">
                                <div class="tm-trace-indent" style="width: 24px;">
                                    <div class="tm-trace-connector ${isLast ? 'tm-last' : ''}"></div>
                                </div>
                                <div class="tm-trace-expand" data-expand="${span.id}">
                                    <i class="fas fa-chevron-${isExpanded ? 'down' : 'right'} text-xs"></i>
                                </div>
                                <div class="tm-trace-icon bg-${span.iconBg}-500/20">
                                    <i class="fas ${span.icon} text-${span.iconBg}-400 text-xs"></i>
                                </div>
                                <div class="tm-trace-name">
                                    <span class="text-white text-sm">${span.service}</span>
                                    <span class="px-1.5 py-0.5 bg-slate-700 text-gray-400 text-xs rounded">${this.formatSpanType(span.type)}</span>
                                    <i class="fas ${statusIcon.icon} ${statusIcon.color} text-xs"></i>
                                </div>
                                <div class="tm-trace-metrics">
                                    ${metricsHtml}
                                </div>
                            </div>
                            ${logsHtml}
                        </div>
                    `;
                }).join('');

                this.elements.traceTree.innerHTML = rootHtml + spansHtml;
            },

            // Format latency for display (handle large values)
            formatLatency(ms) {
                if (ms >= 3600000) {
                    return `${(ms / 3600000).toFixed(1)}h`;
                } else if (ms >= 60000) {
                    return `${(ms / 60000).toFixed(1)}m`;
                } else if (ms >= 1000) {
                    return `${(ms / 1000).toFixed(1)}s`;
                }
                return `${ms}ms`;
            },

            // Render a single span (desktop view)
            renderSpanDesktop(span) {
                const statusClass = this.getStatusClass(span.status);
                const statusIcon = this.getStatusIcon(span.status);
                const statusText = this.getStatusText(span.status);
                const metrics = this.getSpanMetrics(span);
                const borderClass = span.status === 'disabled' || span.status === 'error' ? 'border border-red-500/30' : '';
                
                return `
                    <div class="tm-span bg-slate-800 rounded-lg p-4 ${borderClass}" data-span-id="${span.id}">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-${span.iconBg}-500/20 rounded flex items-center justify-center">
                                    <i class="fas ${span.icon} text-${span.iconBg}-400"></i>
                                </div>
                                <div>
                                    <span class="text-white font-medium">${span.service}</span>
                                    <span class="text-gray-500 text-sm ml-2">${this.formatSpanType(span.type)}</span>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 text-sm">
                                <span class="${statusIcon.color}"><i class="fas ${statusIcon.icon} mr-1"></i>${statusText}</span>
                                <span class="text-gray-400">${span.latency}ms</span>
                                ${metrics}
                            </div>
                        </div>
                        <div class="tm-span-bar bg-slate-700">
                            <div class="tm-span-bar-fill ${statusClass}" style="width: ${span.barWidth}%;"></div>
                        </div>
                    </div>
                `;
            },

            // Render a single span (mobile view)
            renderSpanMobile(span) {
                const statusIcon = this.getStatusIcon(span.status);
                const borderClass = span.status === 'disabled' || span.status === 'error' ? 'border border-red-500/30' : '';
                const mobileMetrics = this.getMobileMetrics(span);
                
                return `
                    <div class="tm-span bg-slate-800 rounded-lg p-4 ${borderClass}" data-span-id="${span.id}">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-10 h-10 bg-${span.iconBg}-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas ${span.icon} text-${span.iconBg}-400 text-lg"></i>
                            </div>
                            <div>
                                <div class="text-white font-medium">${span.service}</div>
                                <div class="text-gray-500 text-xs">${this.formatSpanType(span.type)}</div>
                            </div>
                            <span class="ml-auto ${statusIcon.color} text-sm"><i class="fas ${statusIcon.icon}"></i></span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            ${mobileMetrics}
                        </div>
                    </div>
                `;
            },

            // Get span metrics HTML for desktop
            getSpanMetrics(span) {
                let metrics = '';
                if (span.tokensIn && span.tokensOut) {
                    metrics += `<span class="text-purple-400">${span.tokensIn}â†’${span.tokensOut} tokens</span>`;
                }
                if (span.cost) {
                    metrics += `<span class="text-yellow-400">$${span.cost.toFixed(2)}</span>`;
                }
                if (span.documentsRetrieved) {
                    metrics += `<span class="text-amber-400">${span.documentsRetrieved} docs</span>`;
                }
                if (span.avgRelevanceScore) {
                    metrics += `<span class="text-amber-400">relevance: ${span.avgRelevanceScore}</span>`;
                }
                return metrics;
            },

            // Get mobile metrics HTML
            getMobileMetrics(span) {
                let metrics = `<div class="text-gray-400">Latency: <span class="text-white">${span.latency}ms</span></div>`;
                
                if (span.tokensIn && span.tokensOut) {
                    metrics += `<div class="text-gray-400">Tokens: <span class="text-purple-400">${span.tokensIn}â†’${span.tokensOut}</span></div>`;
                }
                if (span.cost) {
                    metrics += `<div class="text-gray-400">Cost: <span class="text-yellow-400">$${span.cost.toFixed(2)}</span></div>`;
                }
                if (span.documentsRetrieved) {
                    metrics += `<div class="text-gray-400">Docs: <span class="text-amber-400">${span.documentsRetrieved}</span></div>`;
                }
                if (span.avgRelevanceScore) {
                    metrics += `<div class="text-gray-400">Relevance: <span class="text-amber-400">${span.avgRelevanceScore}</span></div>`;
                }
                
                const statusColor = this.getStatusColor(span.status);
                const statusLabel = span.status.charAt(0).toUpperCase() + span.status.slice(1);
                metrics += `<div class="text-gray-400">Status: <span class="${statusColor}">${statusLabel}</span></div>`;
                
                return metrics;
            },

            // Get CSS class for status bar
            getStatusClass(status) {
                const classes = {
                    'success': 'tm-status-success',
                    'warning': 'tm-status-warning',
                    'error': 'tm-status-error',
                    'disabled': 'tm-status-disabled'
                };
                return classes[status] || 'tm-status-success';
            },

            // Get status icon and color
            getStatusIcon(status) {
                const icons = {
                    'success': { icon: 'fa-check-circle', color: 'text-green-400' },
                    'warning': { icon: 'fa-exclamation-triangle', color: 'text-amber-400' },
                    'error': { icon: 'fa-times-circle', color: 'text-red-400' },
                    'disabled': { icon: 'fa-ban', color: 'text-gray-500' }
                };
                return icons[status] || icons['success'];
            },

            // Get status text
            getStatusText(status) {
                const texts = {
                    'success': '200',
                    'warning': '200',
                    'error': '500',
                    'disabled': 'DISABLED'
                };
                return texts[status] || '200';
            },

            // Get status color for mobile
            getStatusColor(status) {
                const colors = {
                    'success': 'text-green-400',
                    'warning': 'text-amber-400',
                    'error': 'text-red-400',
                    'disabled': 'text-red-400'
                };
                return colors[status] || 'text-green-400';
            },

            // Format span type for display
            formatSpanType(type) {
                const types = {
                    'llm-call': 'LLM Call',
                    'rag-retrieval': 'RAG Retrieval',
                    'guardrail': 'Guardrail',
                    'tool-call': 'Tool Call',
                    'agent-step': 'Agent Step'
                };
                return types[type] || type;
            },

            // Bind event listeners
            bindEvents() {
                // Scroll handler for floating bar
                window.addEventListener('scroll', () => {
                    if (!this.state.isPlaying || this.state.showingMenu) {
                        this.hideFloatingBar();
                        return;
                    }
                    
                    const timerEl = this.elements.timerContainer;
                    if (timerEl) {
                        const rect = timerEl.getBoundingClientRect();
                        // Show floating bar when timer is scrolled out of view
                        if (rect.bottom < 0) {
                            this.showFloatingBar();
                        } else {
                            this.hideFloatingBar();
                        }
                    }
                });

                // Click handler for level cards
                document.getElementById('tm-level-cards')?.addEventListener('click', (e) => {
                    const card = e.target.closest('.tm-level-card');
                    if (card) {
                        const levelIndex = parseInt(card.dataset.levelIndex, 10);
                        if (!isNaN(levelIndex)) {
                            this.loadLevel(levelIndex);
                        }
                    }
                });

                // Reset progress button
                const resetBtn = document.getElementById('tm-reset-progress');
                if (resetBtn) {
                    resetBtn.addEventListener('click', () => {
                        this.resetProgress();
                    });
                }

                // Field Guide button
                if (this.elements.fieldGuideBtn) {
                    this.elements.fieldGuideBtn.addEventListener('click', () => {
                        this.showFieldGuide();
                    });
                }

                // Field Guide close buttons
                document.getElementById('tm-field-guide-close')?.addEventListener('click', () => {
                    this.hideFieldGuide();
                });
                document.getElementById('tm-field-guide-ok')?.addEventListener('click', () => {
                    this.hideFieldGuide();
                });

                // Sound toggle button
                if (this.elements.soundBtn) {
                    this.elements.soundBtn.addEventListener('click', () => {
                        this.toggleSound();
                    });
                }

                // Click handler for spans - mobile cards and desktop tree (event delegation)
                document.getElementById('tm-game').addEventListener('click', (e) => {
                    // Handle mobile span cards
                    const spanEl = e.target.closest('.tm-span');
                    if (spanEl) {
                        const spanId = spanEl.dataset.spanId;
                        if (spanId) {
                            this.selectSpan(spanId);
                        }
                        return;
                    }

                    // Handle desktop tree expand/collapse
                    const expandEl = e.target.closest('.tm-trace-expand');
                    if (expandEl) {
                        const spanId = expandEl.dataset.expand;
                        if (spanId) {
                            this.toggleSpanExpand(spanId);
                        }
                        return;
                    }

                    // Handle desktop tree item selection
                    const traceItem = e.target.closest('.tm-trace-item');
                    if (traceItem) {
                        const spanId = traceItem.dataset.spanId;
                        if (spanId && spanId !== 'root') {
                            this.selectSpan(spanId);
                        }
                    }
                });

                // Click handler for action buttons
                document.getElementById('tm-actions').addEventListener('click', (e) => {
                    const btn = e.target.closest('.tm-action-btn');
                    if (btn) {
                        const action = btn.dataset.action;
                        if (action) {
                            this.submitAction(action);
                        }
                    }
                });

                // Modal button handlers
                document.getElementById('tm-modal-retry').addEventListener('click', () => {
                    this.hideModal();
                    this.showLevelMenu();
                });

                document.getElementById('tm-modal-next').addEventListener('click', () => {
                    this.hideModal();
                    this.nextLevel();
                });

                // Close modal on backdrop click
                document.querySelector('.tm-modal-backdrop')?.addEventListener('click', () => {
                    this.hideModal();
                    this.showLevelMenu();
                });
            },

            // Submit an action (fix attempt)
            submitAction(action) {
                if (!this.state.isPlaying) return; // Ignore if game is over
                
                const isCorrect = action === this.currentLevel.correctAction;
                
                if (isCorrect) {
                    this.stopTimer();
                    this.completeLevel();
                    this.playSound('win');
                    this.launchConfetti();
                    this.showModal(true);
                } else {
                    // Shake the game container for wrong answer
                    const gameEl = document.getElementById('tm-game');
                    gameEl.classList.add('tm-shake');
                    setTimeout(() => gameEl.classList.remove('tm-shake'), 500);
                    
                    this.playSound('lose');
                    
                    // Add frustration penalty (+10%)
                    this.addFrustrationPenalty();
                    
                    // Don't show modal for wrong answer - let them keep trying
                    // Only show modal if frustration hits 100%
                }
            },

            // Show result modal
            showModal(isSuccess, isTimeout = false) {
                // Pause timer when modal is shown
                this.pauseTimer();
                
                const modal = document.getElementById('tm-modal');
                const successEl = document.getElementById('tm-modal-success');
                const failureEl = document.getElementById('tm-modal-failure');
                const explanationEl = document.getElementById('tm-modal-explanation');
                const nextBtn = document.getElementById('tm-modal-next');
                const retryBtn = document.getElementById('tm-modal-retry');
                const failureTitle = failureEl.querySelector('h3');
                const failureSubtitle = failureEl.querySelector('p');

                // Show/hide success/failure states
                successEl.classList.toggle('hidden', !isSuccess);
                failureEl.classList.toggle('hidden', isSuccess);

                // Update XP display on success
                if (isSuccess) {
                    const xpAmountEl = document.getElementById('tm-xp-amount');
                    if (xpAmountEl) {
                        xpAmountEl.textContent = this.state.lastEarnedXP;
                    }
                }

                // Update failure message based on timeout vs wrong answer
                if (!isSuccess && failureTitle && failureSubtitle) {
                    if (isTimeout) {
                        failureTitle.textContent = 'Time\'s Up!';
                        failureSubtitle.textContent = 'The customer lost patience.';
                    } else {
                        failureTitle.textContent = 'Wrong Fix!';
                        failureSubtitle.textContent = 'That wasn\'t the root cause.';
                    }
                }

                // Show explanation
                explanationEl.textContent = this.currentLevel.explanation;

                // Show/hide buttons based on result
                if (isSuccess) {
                    nextBtn.classList.remove('hidden');
                    retryBtn.innerHTML = '<i class="fas fa-redo mr-2"></i>Play Again';
                } else {
                    nextBtn.classList.add('hidden');
                    retryBtn.innerHTML = '<i class="fas fa-redo mr-2"></i>Try Again';
                }

                // Show modal
                modal.classList.remove('hidden');
            },

            // Hide result modal
            hideModal() {
                document.getElementById('tm-modal').classList.add('hidden');
            },

            // Reset level to initial state
            resetLevel() {
                this.state.selectedSpanId = 'span-1';
                this.renderSpans();
                this.selectSpan('span-1');
                this.startTimer(); // Restart the timer
            },

            // Toggle span expand/collapse in tree view
            toggleSpanExpand(spanId) {
                const index = this.state.expandedSpans.indexOf(spanId);
                if (index === -1) {
                    this.state.expandedSpans.push(spanId);
                } else {
                    this.state.expandedSpans.splice(index, 1);
                }
                this.renderTreeTrace();
            },

            // Select a span and show its logs
            selectSpan(spanId) {
                this.state.selectedSpanId = spanId;
                
                // Update visual selection for mobile cards
                document.querySelectorAll('.tm-span').forEach(el => {
                    el.classList.toggle('tm-selected', el.dataset.spanId === spanId);
                });

                // Update visual selection for desktop tree items
                document.querySelectorAll('.tm-trace-item').forEach(el => {
                    el.classList.toggle('tm-selected', el.dataset.spanId === spanId);
                });
                
                // Find span data
                const span = this.currentLevel.spans.find(s => s.id === spanId);
                if (!span) return;

                // Auto-expand selected span in tree view
                if (!this.state.expandedSpans.includes(spanId)) {
                    this.state.expandedSpans.push(spanId);
                    this.renderTreeTrace();
                }
                
                // Mobile: Update log viewer title
                if (this.elements.logTitle) {
                    this.elements.logTitle.textContent = span.service;
                }
                
                // Mobile: Update log content
                if (this.elements.logContent) {
                    this.elements.logContent.innerHTML = span.logs.map(log => {
                        const levelClass = this.getLogLevelClass(log.level);
                        const levelColor = this.getLogLevelColor(log.level);
                        return `
                            <div class="tm-log-entry ${levelClass}">
                                <span class="text-gray-500">[${log.time}]</span>
                                <span class="${levelColor} font-semibold"> ${log.level} </span>
                                ${log.message}
                            </div>
                        `;
                    }).join('');
                }
            },

            // Get log level CSS class
            getLogLevelClass(level) {
                const classes = {
                    'INFO': 'tm-log-info',
                    'WARN': 'tm-log-warn',
                    'ERROR': 'tm-log-error'
                };
                return classes[level] || 'tm-log-info';
            },

            // Get log level color
            getLogLevelColor(level) {
                const colors = {
                    'INFO': 'text-blue-400',
                    'WARN': 'text-yellow-400',
                    'ERROR': 'text-red-400'
                };
                return colors[level] || 'text-blue-400';
            }
        };

        // Initialize game when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => TraceMaster.init());
        } else {
            TraceMaster.init();
        }
    </script>
</body>
</html>
