<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Please don't say just hello in chat. Save time by asking your question directly in asynchronous communication.">
    <meta property="og:title" content="No Hello - Communicate Efficiently">
    <meta property="og:description" content="Stop saying just 'hello' and waiting. Ask your question directly and save everyone's time.">
    <meta property="og:type" content="website">
    <title>No Hello - Please Don't Say Just Hello</title>
    
    <!-- Preconnect to external domains for faster loading -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Rybbit Analytics -->
    <script src="https://rybbit.ekathi.com/api/script.js" data-site-id="2" defer></script>
    
    <!-- Load Font Awesome with defer for non-blocking -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    
    <!-- Optimized font loading with display=swap -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"></noscript>
    
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .chat-bubble {
            animation: fadeInUp 0.5s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Prevent layout shift */
        .scroll-fade-in {
            content-visibility: auto;
        }
        
        .typing-indicator {
            display: inline-flex;
            gap: 4px;
        }
        
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #9ca3af;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        .scroll-indicator {
            animation: bounce 2s infinite;
        }
        
        .scroll-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            z-index: 1000;
        }
        
        .scroll-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .scroll-to-top:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
        }
        
        .scroll-to-top:active {
            transform: translateY(-2px);
        }
        
        .comparison-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .comparison-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .scroll-fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease, transform 0.6s ease;
            will-change: opacity, transform;
        }
        
        .scroll-fade-in.visible {
            opacity: 1;
            transform: translateY(0);
            will-change: auto;
        }

        /* ========================================
           Trace Master: 911 Game Styles
           All classes prefixed with tm- to avoid conflicts
           ======================================== */
        
        .tm-game-container {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }

        .tm-ticket-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .tm-frustration-bar {
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
        }

        .tm-frustration-fill {
            background: rgba(15, 23, 42, 0.8);
            transition: width 0.3s ease;
        }

        .tm-span {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .tm-span:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tm-span.tm-selected {
            box-shadow: 0 0 0 2px #667eea;
        }

        .tm-span-bar {
            height: 8px;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .tm-span-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .tm-status-success { background-color: #10b981; }
        .tm-status-warning { background-color: #f59e0b; }
        .tm-status-error { background-color: #ef4444; }
        .tm-status-disabled { 
            background-color: #6b7280; 
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 4px,
                rgba(255,255,255,0.1) 4px,
                rgba(255,255,255,0.1) 8px
            );
        }

        .tm-log-entry {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.75rem;
        }

        .tm-log-info { color: #60a5fa; }
        .tm-log-warn { color: #fbbf24; }
        .tm-log-error { color: #f87171; }

        .tm-action-btn {
            transition: all 0.2s ease;
        }

        .tm-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tm-pulse {
            animation: tm-pulse 2s infinite;
        }

        @keyframes tm-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Mobile: Vertical card layout for spans */
        @media (max-width: 767px) {
            .tm-span-desktop { display: none; }
            .tm-span-mobile { display: block; }
        }
        @media (min-width: 768px) {
            .tm-span-desktop { display: block; }
            .tm-span-mobile { display: none; }
        }

        /* Modal styles */
        .tm-modal {
            position: fixed;
            inset: 0;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .tm-modal.hidden {
            display: none;
        }

        .tm-modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }

        .tm-modal-content {
            position: relative;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 28rem;
            width: 100%;
            animation: tm-modal-in 0.3s ease-out;
        }

        @keyframes tm-modal-in {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Shake animation for wrong answer */
        .tm-shake {
            animation: tm-shake 0.5s ease-in-out;
        }

        @keyframes tm-shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
        }

        /* XP pop animation */
        .tm-xp-pop {
            animation: tm-xp-pop 0.6s ease-out;
        }

        @keyframes tm-xp-pop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Span slide-in animation */
        .tm-span {
            animation: tm-slide-in 0.4s ease-out;
            animation-fill-mode: both;
        }

        .tm-span:nth-child(1) { animation-delay: 0.1s; }
        .tm-span:nth-child(2) { animation-delay: 0.2s; }
        .tm-span:nth-child(3) { animation-delay: 0.3s; }
        .tm-span:nth-child(4) { animation-delay: 0.4s; }

        @keyframes tm-slide-in {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Frustration pulse when > 75% */
        .tm-frustration-critical {
            animation: tm-frustration-pulse 0.5s ease-in-out infinite;
        }

        @keyframes tm-frustration-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Tree trace styles */
        .tm-trace-tree {
            font-family: 'Inter', monospace;
        }

        .tm-trace-item {
            position: relative;
            cursor: pointer;
            transition: background 0.15s;
        }

        .tm-trace-item:hover {
            background: rgba(100, 116, 139, 0.1);
        }

        .tm-trace-item.tm-selected {
            background: rgba(102, 126, 234, 0.15);
        }

        .tm-trace-row {
            display: flex;
            align-items: center;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
        }

        .tm-trace-indent {
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .tm-trace-line {
            width: 1px;
            height: 100%;
            background: #475569;
            margin-right: 0.75rem;
        }

        .tm-trace-connector {
            width: 20px;
            height: 20px;
            position: relative;
            flex-shrink: 0;
        }

        .tm-trace-connector::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 50%;
            width: 1px;
            background: #475569;
        }

        .tm-trace-connector::after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 12px;
            height: 1px;
            background: #475569;
        }

        .tm-trace-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-right: 0.5rem;
        }

        .tm-trace-name {
            flex: 1;
            min-width: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tm-trace-metrics {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-left: auto;
            flex-shrink: 0;
        }

        .tm-trace-expand {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            cursor: pointer;
        }

        .tm-trace-expand:hover {
            color: #94a3b8;
        }

        /* Expanded logs section */
        .tm-trace-logs {
            margin-left: 44px;
            padding: 0.75rem;
            background: #0f172a;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
        }

        /* Floating status bar */
        .tm-floating-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            border-bottom: 1px solid #4c1d95;
            padding: 0.5rem 1rem;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .tm-floating-bar.tm-visible {
            transform: translateY(0);
        }

        .tm-floating-bar-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .tm-floating-frustration {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .tm-floating-frustration-bar {
            flex: 1;
            max-width: 200px;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .tm-floating-frustration-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e 0%, #eab308 50%, #ef4444 100%);
            transition: width 0.3s;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    
    <!-- Floating Status Bar (appears when scrolled past timer) -->
    <div id="tm-floating-bar" class="tm-floating-bar hidden">
        <div class="tm-floating-bar-content">
            <div class="tm-floating-frustration">
                <span id="tm-floating-emoji" class="text-xl">ðŸ˜Š</span>
                <div class="tm-floating-frustration-bar">
                    <div id="tm-floating-frustration-fill" class="tm-floating-frustration-fill" style="width: 0%;"></div>
                </div>
                <span id="tm-floating-frustration-text" class="text-white font-bold text-sm">0%</span>
            </div>
            <div class="flex items-center gap-2">
                <i id="tm-floating-timer-icon" class="fas fa-clock text-green-400"></i>
                <span id="tm-floating-timer" class="text-white font-mono text-xl font-bold">2:00</span>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="min-h-screen flex items-center justify-center px-4 py-20 bg-gradient-to-br from-purple-50 via-white to-blue-50">
        <div class="max-w-4xl mx-auto text-center">
            <div class="mb-8">
                <i class="fas fa-comment-slash text-6xl text-purple-600 mb-6"></i>
            </div>
            <h1 class="text-5xl md:text-7xl font-bold mb-6 gradient-text">
                Please Don't Say Just Hello
            </h1>
            <p class="text-xl md:text-2xl text-gray-600 mb-12 max-w-2xl mx-auto">
                Imagine calling someone on the phone, saying "hello," and then putting them on hold. That's what you're doing when you say just "hello" in chat.
            </p>
            <a href="#why" class="inline-flex items-center gap-2 bg-purple-600 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-purple-700 transition-colors shadow-lg hover:shadow-xl">
                Learn Why
                <i class="fas fa-arrow-down scroll-indicator"></i>
            </a>
        </div>
    </section>

    <!-- Problem Demonstration -->
    <section id="why" class="py-20 px-4 bg-white">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-4xl md:text-5xl font-bold text-center mb-16">
                The Problem
            </h2>
            
            <div class="grid md:grid-cols-2 gap-8 mb-16">
                <!-- Bad Example -->
                <div class="comparison-card bg-red-50 border-2 border-red-200 rounded-2xl p-8 scroll-fade-in">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-times-circle text-3xl text-red-600"></i>
                        <h3 class="text-2xl font-bold text-red-900">Don't Do This</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="chat-bubble bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-red-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-red-700 text-sm"></i>
                                </div>
                                <span class="font-semibold text-sm">You</span>
                                <span class="text-xs text-gray-500">2:31 PM</span>
                            </div>
                            <p class="text-gray-800">Hi Soumendra</p>
                        </div>
                        
                        <div class="chat-bubble bg-gray-100 rounded-lg p-4 flex items-center gap-2">
                            <div class="typing-indicator">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                            <span class="text-sm text-gray-500 ml-2">waiting for response...</span>
                        </div>
                        
                        <div class="chat-bubble bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-blue-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-blue-700 text-sm"></i>
                                </div>
                                <span class="font-semibold text-sm">Soumendra</span>
                                <span class="text-xs text-gray-500">2:45 PM</span>
                            </div>
                            <p class="text-gray-800">Hi! What's up?</p>
                        </div>
                        
                        <div class="chat-bubble bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-red-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-red-700 text-sm"></i>
                                </div>
                                <span class="font-semibold text-sm">You</span>
                                <span class="text-xs text-gray-500">2:46 PM</span>
                            </div>
                            <p class="text-gray-800">Can you help me with the observability platform access?</p>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-red-100 rounded-lg">
                        <p class="text-sm text-red-800">
                            <i class="fas fa-clock mr-2"></i>
                            <strong>15 minutes wasted</strong> waiting for a response
                        </p>
                    </div>
                </div>
                
                <!-- Good Example -->
                <div class="comparison-card bg-green-50 border-2 border-green-200 rounded-2xl p-8 scroll-fade-in">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-check-circle text-3xl text-green-600"></i>
                        <h3 class="text-2xl font-bold text-green-900">Do This Instead</h3>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="chat-bubble bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-green-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-green-700 text-sm"></i>
                                </div>
                                <span class="font-semibold text-sm">You</span>
                                <span class="text-xs text-gray-500">2:31 PM</span>
                            </div>
                            <p class="text-gray-800">Hi Soumendra! Can you help me get access to the AI observability platform? I need to integrate it for our Agentic AI project. My team name is 007 Agent Builders and my email is bruce@agenticai.com</p>
                        </div>
                        
                        <div class="chat-bubble bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-8 h-8 bg-blue-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-blue-700 text-sm"></i>
                                </div>
                                <span class="font-semibold text-sm">Soumendra</span>
                                <span class="text-xs text-gray-500">2:45 PM</span>
                            </div>
                            <p class="text-gray-800">Sure! I'll create your account and send you the API keys. You can start with our quickstart guide here: [link]</p>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-green-100 rounded-lg">
                        <p class="text-sm text-green-800">
                            <i class="fas fa-bolt mr-2"></i>
                            <strong>Efficient communication</strong> - problem solved immediately
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Why This Matters -->
    <section class="py-20 px-4 bg-gray-50">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-4xl md:text-5xl font-bold text-center mb-16 scroll-fade-in">
                Why This Matters
            </h2>
            
            <div class="grid md:grid-cols-3 gap-8">
                <div class="bg-white rounded-xl p-8 shadow-lg scroll-fade-in">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mb-6">
                        <i class="fas fa-clock text-2xl text-purple-600"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4">Respects Time</h3>
                    <p class="text-gray-600">
                        Your colleague can respond when available without being held hostage by a conversation that hasn't started yet.
                    </p>
                </div>
                
                <div class="bg-white rounded-xl p-8 shadow-lg scroll-fade-in">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-6">
                        <i class="fas fa-globe text-2xl text-blue-600"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4">Async-First</h3>
                    <p class="text-gray-600">
                        Remote teams work across time zones. Async communication means providing context upfront, not waiting for acknowledgment.
                    </p>
                </div>
                
                <div class="bg-white rounded-xl p-8 shadow-lg scroll-fade-in">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-6">
                        <i class="fas fa-brain text-2xl text-green-600"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4">Better Focus</h3>
                    <p class="text-gray-600">
                        Reduces context switching. Your colleague can read your full message and respond thoughtfully in one go.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- More Examples -->
    <section class="py-20 px-4 bg-white">
        <div class="max-w-5xl mx-auto">
            <h2 class="text-4xl md:text-5xl font-bold text-center mb-16 scroll-fade-in">
                More Examples
            </h2>
            
            <div class="space-y-8">
                <!-- Example 1 -->
                <div class="grid md:grid-cols-2 gap-6 scroll-fade-in">
                    <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-times text-red-600"></i>
                            <span class="font-bold text-red-900">Bad</span>
                        </div>
                        <p class="text-gray-800">"Hey Soumendra, are you there?"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">Forces synchronous response</p>
                    </div>
                    <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-check text-green-600"></i>
                            <span class="font-bold text-green-900">Good</span>
                        </div>
                        <p class="text-gray-800">"Hey Soumendra! Quick question - where can I find the API documentation for integrating the observability SDK with our Python project?"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">Can be answered anytime</p>
                    </div>
                </div>
                
                <!-- Example 2 -->
                <div class="grid md:grid-cols-2 gap-6 scroll-fade-in">
                    <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-times text-red-600"></i>
                            <span class="font-bold text-red-900">Bad</span>
                        </div>
                        <p class="text-gray-800">"Hi Soumendra, do you have a minute?"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">Vague and anxiety-inducing</p>
                    </div>
                    <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-check text-green-600"></i>
                            <span class="font-bold text-green-900">Good</span>
                        </div>
                        <p class="text-gray-800">"Hi Soumendra! I need help integrating observability into our RAG pipeline. We're using LangChain with GPT-4. Can you share the integration guide when you have 10 minutes?"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">Clear context and expectations</p>
                    </div>
                </div>
                
                <!-- Example 3 -->
                <div class="grid md:grid-cols-2 gap-6 scroll-fade-in">
                    <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-times text-red-600"></i>
                            <span class="font-bold text-red-900">Bad</span>
                        </div>
                        <p class="text-gray-800">"Ping"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">No context about what you need</p>
                    </div>
                    <div class="bg-green-50 border-l-4 border-green-500 p-6 rounded-lg">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-check text-green-600"></i>
                            <span class="font-bold text-green-900">Good</span>
                        </div>
                        <p class="text-gray-800">"Our observability dashboard is showing 'API key invalid' errors. I've checked the key in our .env file and it looks correct. Can you help troubleshoot? Project: customer-support-bot"</p>
                        <p class="text-sm text-gray-600 mt-2 italic">Actionable with context</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Call to Action -->
    <section class="py-20 px-4 bg-gradient-to-br from-purple-600 to-blue-600 text-white">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-4xl md:text-5xl font-bold mb-6">
                Spread the Word
            </h2>
            <p class="text-xl md:text-2xl mb-12 opacity-90">
                Help your team communicate more efficiently. Share this page!
            </p>
            
            <div class="flex flex-wrap justify-center gap-4 mb-12">
                <button onclick="copyLink()" class="bg-white text-purple-600 px-8 py-4 rounded-lg font-semibold hover:bg-gray-100 transition-colors shadow-lg flex items-center gap-2">
                    <i class="fas fa-link"></i>
                    Copy Link
                </button>
                <a href="https://twitter.com/intent/tweet?text=Please%20don%27t%20say%20just%20hello%20in%20chat.%20Ask%20your%20question%20directly!&url=" target="_blank" rel="noopener" class="bg-white text-blue-500 px-8 py-4 rounded-lg font-semibold hover:bg-gray-100 transition-colors shadow-lg flex items-center gap-2">
                    <i class="fab fa-twitter"></i>
                    Share on Twitter
                </a>
            </div>
            
            <div id="copyNotification" class="hidden bg-green-500 text-white px-6 py-3 rounded-lg inline-block shadow-lg">
                <i class="fas fa-check mr-2"></i>
                Link copied to clipboard!
            </div>
        </div>
    </section>

    <!-- ========================================
         Trace Master: 911 - AI Observability Game
         ======================================== -->
    <section id="trace-master" class="tm-game-container py-20 px-4">
        <div class="max-w-6xl mx-auto">
            <!-- Game Header -->
            <div class="text-center mb-12 scroll-fade-in">
                <div class="inline-flex items-center gap-3 mb-4">
                    <i class="fas fa-terminal text-4xl text-purple-400"></i>
                    <h2 class="text-4xl md:text-5xl font-bold text-white">Trace Master: 911</h2>
                </div>
                <p class="text-xl text-gray-400 max-w-2xl mx-auto">
                    Debug AI agent failures before customers lose patience. Can you find the root cause?
                </p>
            </div>

            <!-- Level Selection Menu -->
            <div id="tm-level-menu" class="scroll-fade-in">
                <div class="text-center mb-8">
                    <h3 class="text-2xl font-bold text-white mb-2">Select a Ticket</h3>
                    <p class="text-gray-400">Choose an AI incident to investigate</p>
                </div>
                <div id="tm-level-cards" class="grid md:grid-cols-3 gap-6">
                    <!-- Level cards rendered by JavaScript -->
                </div>
                <div class="text-center mt-8">
                    <button id="tm-reset-progress" class="text-gray-500 hover:text-gray-300 text-sm transition-colors">
                        <i class="fas fa-redo mr-1"></i>Reset Progress
                    </button>
                </div>
            </div>

            <!-- Game Container (hidden initially) -->
            <div id="tm-game" class="scroll-fade-in hidden">
                <!-- Ticket Header -->
                <div class="tm-ticket-card rounded-t-2xl p-6">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <!-- Ticket Info -->
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-red-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-ticket-alt text-2xl text-red-400"></i>
                            </div>
                            <div>
                                <div class="flex items-center gap-2">
                                    <span id="tm-ticket-id" class="text-white font-bold text-lg">TKT-001</span>
                                    <span id="tm-ticket-severity" class="px-2 py-0.5 bg-red-500/20 text-red-400 text-xs font-semibold rounded-full">HIGH</span>
                                </div>
                                <div id="tm-ticket-reporter" class="text-gray-400 text-sm">
                                    <i class="fas fa-user mr-1"></i> PizzaLover123
                                </div>
                            </div>
                        </div>

                        <!-- Frustration Meter -->
                        <div class="flex-1 max-w-md">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-gray-400 text-sm font-medium flex items-center gap-2">
                                    <span id="tm-frustration-emoji" class="text-lg">ðŸ˜Š</span>
                                    Customer Frustration
                                </span>
                                <span id="tm-frustration-text" class="text-green-400 font-bold">0%</span>
                            </div>
                            <div class="h-3 bg-gray-700 rounded-full overflow-hidden relative">
                                <div class="tm-frustration-bar h-full w-full absolute"></div>
                                <div id="tm-frustration-fill" class="tm-frustration-fill h-full absolute right-0" style="width: 100%;"></div>
                            </div>
                        </div>

                        <!-- Timer -->
                        <div id="tm-timer-container" class="flex items-center gap-2 text-white">
                            <i id="tm-timer-icon" class="fas fa-clock text-green-400"></i>
                            <span id="tm-timer" class="font-mono text-2xl font-bold">2:00</span>
                        </div>
                    </div>

                    <!-- Issue Description -->
                    <div class="mt-6 p-4 bg-slate-800/50 rounded-lg border border-slate-600/50">
                        <p id="tm-ticket-description" class="text-gray-200 text-lg">
                            <i class="fas fa-quote-left text-gray-500 mr-2"></i>
                            AI recipe assistant is inventing ingredients that don't exist! It suggested "moonbeam flour" and "crystallized starlight" for my pizza recipe.
                            <i class="fas fa-quote-right text-gray-500 ml-2"></i>
                        </p>
                    </div>
                </div>

                <!-- Main Game Area -->
                <div class="bg-slate-900 p-6 border-x border-slate-700">
                    <!-- Section: AI Agent Trace -->
                    <div class="mb-8">
                        <h3 class="text-white font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-project-diagram text-purple-400"></i>
                            AI Agent Trace
                        </h3>

                        <!-- Desktop: Tree Trace View (Langfuse-style) -->
                        <div id="tm-trace-desktop" class="tm-trace-desktop hidden md:block">
                            <div id="tm-trace-tree" class="tm-trace-tree bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
                                <!-- Tree trace items rendered by JavaScript -->
                            </div>
                        </div>

                        <!-- Mobile: Vertical Card View (dynamically rendered) -->
                        <div id="tm-spans-mobile" class="tm-span-mobile block md:hidden space-y-3">
                            <!-- Spans rendered by JavaScript -->
                        </div>
                    </div>

                    <!-- Section: Log Viewer (Mobile Only) -->
                    <div id="tm-log-viewer" class="mb-8 block md:hidden">
                        <h3 class="text-white font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-terminal text-green-400"></i>
                            Log Viewer
                            <span id="tm-log-title" class="text-gray-500 text-sm font-normal ml-2">Select a span</span>
                        </h3>
                        <div class="bg-slate-950 rounded-lg p-4 border border-slate-700 max-h-48 overflow-y-auto">
                            <div id="tm-log-content" class="space-y-2">
                                <!-- Logs rendered by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Section: Fix Actions -->
                    <div>
                        <h3 class="text-white font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-wrench text-orange-400"></i>
                            Select Fix Action
                        </h3>
                        <div id="tm-actions" class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="adjust-prompt">
                                <i class="fas fa-edit text-2xl text-blue-400 mb-2"></i>
                                <div class="text-sm font-medium">Adjust Prompt</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="update-rag">
                                <i class="fas fa-sync-alt text-2xl text-amber-400 mb-2"></i>
                                <div class="text-sm font-medium">Update RAG Index</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="tune-guardrails">
                                <i class="fas fa-sliders-h text-2xl text-purple-400 mb-2"></i>
                                <div class="text-sm font-medium">Tune Guardrails</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="increase-context">
                                <i class="fas fa-expand-arrows-alt text-2xl text-green-400 mb-2"></i>
                                <div class="text-sm font-medium">Increase Context</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="add-few-shot">
                                <i class="fas fa-list-ol text-2xl text-cyan-400 mb-2"></i>
                                <div class="text-sm font-medium">Add Few-Shot</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="fix-sql-schema">
                                <i class="fas fa-table text-2xl text-pink-400 mb-2"></i>
                                <div class="text-sm font-medium">Fix SQL Schema</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="fix-tool-schema">
                                <i class="fas fa-plug text-2xl text-red-400 mb-2"></i>
                                <div class="text-sm font-medium">Fix Tool Schema</div>
                            </button>
                            <button class="tm-action-btn bg-slate-800 hover:bg-slate-700 text-white rounded-lg p-4 text-center border border-slate-600" data-action="clear-cache">
                                <i class="fas fa-eraser text-2xl text-gray-400 mb-2"></i>
                                <div class="text-sm font-medium">Clear Cache</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Game Footer -->
                <div class="tm-ticket-card rounded-b-2xl p-4 flex flex-col md:flex-row items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <button id="tm-field-guide-btn" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fas fa-book mr-2"></i>Field Guide
                        </button>
                        <button id="tm-sound-btn" class="text-gray-400 hover:text-white transition-colors">
                            <i id="tm-sound-icon" class="fas fa-volume-up mr-2"></i><span id="tm-sound-text">Sound: On</span>
                        </button>
                    </div>
                    <div class="flex items-center gap-4 text-sm">
                        <div class="text-gray-400">
                            <i class="fas fa-star text-yellow-400 mr-1"></i>
                            <span id="tm-total-xp" class="text-white font-bold">0</span> XP
                        </div>
                        <div class="text-gray-400">
                            <i class="fas fa-check-double text-green-400 mr-1"></i>
                            <span id="tm-resolved-count" class="text-white font-bold">0</span> Resolved
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Result Modal (Success/Failure) -->
        <div id="tm-modal" class="tm-modal hidden">
            <div class="tm-modal-backdrop"></div>
            <div class="tm-modal-content">
                <!-- Success State -->
                <div id="tm-modal-success" class="hidden">
                    <div class="text-center mb-6">
                        <div class="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-check-circle text-5xl text-green-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">Ticket Resolved!</h3>
                        <p class="text-gray-400">You found the root cause!</p>
                        <div id="tm-xp-earned" class="mt-4 inline-flex items-center gap-2 bg-yellow-500/20 text-yellow-400 px-4 py-2 rounded-full font-bold tm-xp-pop">
                            <i class="fas fa-star"></i>
                            <span>+<span id="tm-xp-amount">0</span> XP</span>
                        </div>
                    </div>
                </div>

                <!-- Failure State -->
                <div id="tm-modal-failure" class="hidden">
                    <div class="text-center mb-6">
                        <div class="w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-times-circle text-5xl text-red-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-2">Wrong Fix!</h3>
                        <p class="text-gray-400">That wasn't the root cause.</p>
                    </div>
                </div>

                <!-- Explanation (shown for both) -->
                <div class="bg-slate-800 rounded-lg p-4 mb-6">
                    <h4 class="text-white font-semibold mb-2 flex items-center gap-2">
                        <i class="fas fa-lightbulb text-yellow-400"></i>
                        Root Cause Analysis
                    </h4>
                    <p id="tm-modal-explanation" class="text-gray-300 text-sm leading-relaxed"></p>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-3">
                    <button id="tm-modal-retry" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 px-4 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-redo mr-2"></i>Try Again
                    </button>
                    <button id="tm-modal-next" class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white py-3 px-4 rounded-lg font-semibold transition-colors hidden">
                        <i class="fas fa-arrow-right mr-2"></i>Next Ticket
                    </button>
                </div>
            </div>
        </div>

        <!-- Field Guide Modal -->
        <div id="tm-field-guide-modal" class="tm-modal hidden">
            <div class="tm-modal-backdrop"></div>
            <div class="tm-modal-content max-w-2xl">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                        <i class="fas fa-book text-purple-400"></i>
                        AI Observability Field Guide
                    </h2>
                    <button id="tm-field-guide-close" class="text-gray-400 hover:text-white text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="space-y-4 max-h-96 overflow-y-auto pr-2">
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-purple-400 font-semibold mb-2"><i class="fas fa-ghost mr-2"></i>Hallucination</h3>
                        <p class="text-gray-300 text-sm">When an LLM generates false or fabricated information that sounds plausible but isn't grounded in facts or the provided context. Often caused by high temperature settings or poor RAG retrieval.</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-amber-400 font-semibold mb-2"><i class="fas fa-database mr-2"></i>RAG (Retrieval-Augmented Generation)</h3>
                        <p class="text-gray-300 text-sm">A technique that retrieves relevant documents from a knowledge base and provides them as context to the LLM. Failures occur when wrong documents are retrieved (low relevance scores) or the index is stale.</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-red-400 font-semibold mb-2"><i class="fas fa-shield-alt mr-2"></i>Prompt Injection</h3>
                        <p class="text-gray-300 text-sm">A security attack where malicious users craft inputs that override the system prompt, causing the LLM to ignore its instructions. Prevented by input sanitization guardrails.</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-blue-400 font-semibold mb-2"><i class="fas fa-code mr-2"></i>Text-to-SQL</h3>
                        <p class="text-gray-300 text-sm">Converting natural language queries into SQL. Errors occur when the LLM generates syntactically correct but semantically wrong queries, often due to incorrect schema mappings.</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-green-400 font-semibold mb-2"><i class="fas fa-filter mr-2"></i>Guardrails</h3>
                        <p class="text-gray-300 text-sm">Safety checks that validate inputs and outputs. Include content filters, factuality checkers, and prompt injection detectors. Can be set to 'block' or 'log_only' mode.</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-orange-400 font-semibold mb-2"><i class="fas fa-coins mr-2"></i>Token Cost Explosion</h3>
                        <p class="text-gray-300 text-sm">Runaway API costs from agent loops that never terminate. Caused by missing completion criteria or max iteration limits. Always set boundaries on autonomous agents!</p>
                    </div>
                    <div class="bg-slate-800 rounded-lg p-4">
                        <h3 class="text-cyan-400 font-semibold mb-2"><i class="fas fa-tools mr-2"></i>Tool/Function Calling</h3>
                        <p class="text-gray-300 text-sm">LLMs can call external tools/APIs. Failures occur when the tool schema is misconfigured, wrong parameters are passed, or the tool returns unexpected results.</p>
                    </div>
                </div>
                <div class="mt-6">
                    <button id="tm-field-guide-ok" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white py-3 px-4 rounded-lg font-semibold transition-colors">
                        Got it!
                    </button>
                </div>
            </div>
        </div>

        <!-- Confetti Canvas -->
        <canvas id="tm-confetti" class="fixed inset-0 pointer-events-none z-50"></canvas>
    </section>

    <!-- Scroll to Top Button -->
    <button id="scrollToTop" class="scroll-to-top" aria-label="Scroll to top">
        <i class="fas fa-arrow-up text-xl"></i>
    </button>

    <!-- Footer -->
    <footer class="py-12 px-4 bg-gray-900 text-gray-400">
        <div class="max-w-4xl mx-auto text-center">
            <p class="mb-4">
                Inspired by <a href="https://nohello.net" target="_blank" rel="noopener" class="text-purple-400 hover:text-purple-300 underline">nohello.net</a> and the async-first communication movement.
            </p>
            <p class="text-sm">
                Built with â¤ï¸ for better communication by <span class="text-purple-400 font-semibold">Soumendra</span>.
            </p>
        </div>
    </footer>

    <script>
        // Use requestIdleCallback for non-critical animations
        function initScrollAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target); // Stop observing once visible
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.scroll-fade-in').forEach(el => {
                observer.observe(el);
            });
        }
        
        // Defer non-critical initialization
        if ('requestIdleCallback' in window) {
            requestIdleCallback(initScrollAnimations);
        } else {
            setTimeout(initScrollAnimations, 1);
        }

        // Copy link functionality
        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                const notification = document.getElementById('copyNotification');
                notification.classList.remove('hidden');
                setTimeout(() => notification.classList.add('hidden'), 3000);
            });
        }

        // Smooth scroll for anchor links (delegated event)
        document.addEventListener('click', (e) => {
            const anchor = e.target.closest('a[href^="#"]');
            if (anchor) {
                e.preventDefault();
                const target = document.querySelector(anchor.getAttribute('href'));
                if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }, { passive: false });

        // Scroll to top button functionality with throttling
        const scrollToTopBtn = document.getElementById('scrollToTop');
        let scrollTimeout;
        
        // Throttled scroll handler
        window.addEventListener('scroll', () => {
            if (scrollTimeout) return;
            scrollTimeout = setTimeout(() => {
                scrollToTopBtn.classList.toggle('visible', window.pageYOffset > 300);
                scrollTimeout = null;
            }, 100);
        }, { passive: true });
        
        // Scroll to top when button is clicked
        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // ========================================
        // Trace Master: 911 - Game Logic
        // All game code namespaced under TraceMaster
        // ========================================
        const TraceMaster = {
            // All levels data
            levels: [
                {
                    id: "TKT-001",
                    title: "The Hallucinating Recipe Bot",
                    reporter: "PizzaLover123",
                    description: "AI recipe assistant is inventing ingredients that don't exist! It suggested \"moonbeam flour\" and \"crystallized starlight\" for my pizza recipe.",
                    severity: "high",
                    timeLimit: 120,
                    frustrationRate: 0.5,
                    xpReward: 100,
                    category: "hallucination",
                    difficulty: "Easy",
                    spans: [
                        {
                            id: "span-1",
                            type: "llm-call",
                            service: "GPT-4 Turbo",
                            status: "success",
                            latency: 1250,
                            tokensIn: 450,
                            tokensOut: 380,
                            cost: 0.02,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 85,
                            logs: [
                                { level: "INFO", time: "14:32:01.234", message: "Prompt: Generate a pizza recipe for user" },
                                { level: "INFO", time: "14:32:01.235", message: "Temperature: 0.9, Max tokens: 500" },
                                { level: "WARN", time: "14:32:01.236", message: "High temperature setting detected (0.9 > 0.7 threshold)" },
                                { level: "INFO", time: "14:32:02.486", message: "Completion received: 380 tokens in 1250ms" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "rag-retrieval",
                            service: "Recipe Knowledge Base",
                            status: "warning",
                            latency: 85,
                            documentsRetrieved: 3,
                            avgRelevanceScore: 0.42,
                            icon: "fa-database",
                            iconBg: "amber",
                            barWidth: 15,
                            logs: [
                                { level: "INFO", time: "14:32:00.100", message: "Query: pizza recipe ingredients" },
                                { level: "INFO", time: "14:32:00.150", message: "Searching vector index: recipe_embeddings_v2" },
                                { level: "WARN", time: "14:32:00.180", message: "Relevance scores: [0.45, 0.41, 0.39] - Below threshold 0.7" },
                                { level: "WARN", time: "14:32:00.185", message: "Retrieved docs may not be relevant to query" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "guardrail",
                            service: "Factuality Checker",
                            status: "disabled",
                            latency: 0,
                            icon: "fa-shield-alt",
                            iconBg: "red",
                            barWidth: 100,
                            logs: [
                                { level: "ERROR", time: "14:32:02.490", message: "Guardrail SKIPPED - Feature flag 'factuality_check' is disabled" },
                                { level: "ERROR", time: "14:32:02.491", message: "No hallucination detection performed" },
                                { level: "WARN", time: "14:32:02.492", message: "Output passed without factuality validation" }
                            ]
                        }
                    ],
                    rootCause: "span-3",
                    correctAction: "tune-guardrails",
                    explanation: "The Factuality Checker guardrail was disabled, allowing hallucinated content to pass through. The low RAG relevance scores (0.42 avg) meant the LLM had poor context, and combined with high temperature (0.9), it invented ingredients.",
                    redHerrings: ["span-2"]
                },
                {
                    id: "TKT-002",
                    title: "The SQL Injection Agent",
                    reporter: "DataDriven42",
                    description: "Our Text-to-SQL agent is returning wrong sales data! It says we made $0 in Q4 but I know that's not right.",
                    severity: "critical",
                    timeLimit: 100,
                    frustrationRate: 0.6,
                    xpReward: 150,
                    category: "text-to-sql",
                    difficulty: "Easy",
                    spans: [
                        {
                            id: "span-1",
                            type: "llm-call",
                            service: "GPT-4 Turbo",
                            status: "success",
                            latency: 2100,
                            tokensIn: 680,
                            tokensOut: 120,
                            cost: 0.03,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 95,
                            logs: [
                                { level: "INFO", time: "09:15:22.100", message: "Prompt: Convert to SQL: 'Show Q4 sales revenue'" },
                                { level: "INFO", time: "09:15:22.101", message: "Schema context: 5 tables provided" },
                                { level: "INFO", time: "09:15:24.200", message: "Generated SQL: SELECT SUM(amount) FROM sales WHERE quarter='Q4'" },
                                { level: "INFO", time: "09:15:24.201", message: "Query syntax validated successfully" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "tool-call",
                            service: "SQL Executor",
                            status: "success",
                            latency: 45,
                            icon: "fa-database",
                            iconBg: "green",
                            barWidth: 10,
                            logs: [
                                { level: "INFO", time: "09:15:24.250", message: "Executing query on database: analytics_prod" },
                                { level: "INFO", time: "09:15:24.295", message: "Query returned 1 row" },
                                { level: "INFO", time: "09:15:24.296", message: "Result: NULL (no matching records)" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "tool-call",
                            service: "Schema Mapper",
                            status: "error",
                            latency: 12,
                            icon: "fa-table",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "INFO", time: "09:15:22.050", message: "Loading schema mappings from config" },
                                { level: "ERROR", time: "09:15:22.062", message: "Table 'orders' not found in schema map" },
                                { level: "ERROR", time: "09:15:22.063", message: "Falling back to 'sales' table (incorrect mapping)" },
                                { level: "WARN", time: "09:15:22.064", message: "Schema version mismatch: config v2.1, db v3.0" }
                            ]
                        }
                    ],
                    rootCause: "span-3",
                    correctAction: "fix-sql-schema",
                    explanation: "The Schema Mapper failed to find the 'orders' table and fell back to the wrong 'sales' table. The database was upgraded to v3.0 but the schema config is still v2.1. The LLM generated syntactically correct SQL, but against the wrong table.",
                    redHerrings: ["span-1"]
                },
                {
                    id: "TKT-003",
                    title: "The Confused Customer Support Agent",
                    reporter: "SupportLead_Emma",
                    description: "Our support chatbot is giving completely irrelevant answers! Customer asked about refund policy and it responded with shipping information.",
                    severity: "high",
                    timeLimit: 90,
                    frustrationRate: 0.7,
                    xpReward: 200,
                    category: "rag-failure",
                    difficulty: "Medium",
                    spans: [
                        {
                            id: "span-1",
                            type: "rag-retrieval",
                            service: "Support Knowledge Base",
                            status: "warning",
                            latency: 120,
                            documentsRetrieved: 5,
                            avgRelevanceScore: 0.31,
                            icon: "fa-database",
                            iconBg: "amber",
                            barWidth: 25,
                            logs: [
                                { level: "INFO", time: "11:45:30.100", message: "Query: 'What is your refund policy?'" },
                                { level: "INFO", time: "11:45:30.150", message: "Embedding model: text-embedding-ada-002" },
                                { level: "WARN", time: "11:45:30.220", message: "Top result relevance: 0.38 (below 0.7 threshold)" },
                                { level: "WARN", time: "11:45:30.221", message: "Retrieved: shipping_policy.md, delivery_times.md, ..." }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "llm-call",
                            service: "Claude 3 Sonnet",
                            status: "success",
                            latency: 890,
                            tokensIn: 1200,
                            tokensOut: 250,
                            cost: 0.01,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 60,
                            logs: [
                                { level: "INFO", time: "11:45:30.230", message: "Context: 5 documents (2,400 tokens)" },
                                { level: "INFO", time: "11:45:30.231", message: "System prompt: 'Answer based only on provided context'" },
                                { level: "INFO", time: "11:45:31.120", message: "Response generated successfully" },
                                { level: "INFO", time: "11:45:31.121", message: "Confidence score: 0.92" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "tool-call",
                            service: "Vector Index",
                            status: "error",
                            latency: 5,
                            icon: "fa-vector-square",
                            iconBg: "red",
                            barWidth: 3,
                            logs: [
                                { level: "INFO", time: "11:45:30.105", message: "Index: support_docs_v2" },
                                { level: "ERROR", time: "11:45:30.108", message: "Index last updated: 45 days ago" },
                                { level: "ERROR", time: "11:45:30.109", message: "Missing documents: refund_policy.md (added 30 days ago)" },
                                { level: "WARN", time: "11:45:30.110", message: "Embedding drift detected: model updated, index stale" }
                            ]
                        }
                    ],
                    rootCause: "span-3",
                    correctAction: "update-rag",
                    explanation: "The Vector Index is 45 days stale and missing the refund_policy.md document that was added 30 days ago. Additionally, embedding drift was detected - the embedding model was updated but the index wasn't re-embedded. The LLM performed well with the context it received, but RAG retrieved wrong documents.",
                    redHerrings: ["span-2"]
                },
                {
                    id: "TKT-004",
                    title: "The Infinite Loop Agent",
                    reporter: "FinanceBot_Admin",
                    description: "Our financial analysis agent ran for 3 hours and burned through $847 in API costs! It was supposed to generate a simple quarterly report.",
                    severity: "critical",
                    timeLimit: 80,
                    frustrationRate: 0.8,
                    xpReward: 250,
                    category: "token-explosion",
                    difficulty: "Medium",
                    spans: [
                        {
                            id: "span-1",
                            type: "agent-step",
                            service: "Report Orchestrator",
                            status: "warning",
                            latency: 10800000,
                            icon: "fa-cogs",
                            iconBg: "amber",
                            barWidth: 100,
                            logs: [
                                { level: "INFO", time: "09:00:00.000", message: "Starting quarterly report generation" },
                                { level: "INFO", time: "09:00:00.100", message: "Task: 'Generate Q4 financial summary'" },
                                { level: "WARN", time: "09:15:00.000", message: "Agent iteration 50 - still refining output" },
                                { level: "WARN", time: "10:30:00.000", message: "Agent iteration 200 - task not marked complete" },
                                { level: "ERROR", time: "12:00:00.000", message: "Agent iteration 500 - TIMEOUT after 3 hours" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "llm-call",
                            service: "GPT-4 Turbo",
                            status: "success",
                            latency: 2500,
                            tokensIn: 8500,
                            tokensOut: 4200,
                            cost: 847.23,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 95,
                            logs: [
                                { level: "INFO", time: "09:00:01.000", message: "LLM call #1: Analyzing financial data" },
                                { level: "INFO", time: "09:00:03.500", message: "LLM call #1 complete: 4,200 tokens" },
                                { level: "WARN", time: "12:00:00.000", message: "Total LLM calls: 500" },
                                { level: "WARN", time: "12:00:00.001", message: "Total tokens: 6,350,000 (input) + 2,100,000 (output)" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "tool-call",
                            service: "Task Completion Checker",
                            status: "error",
                            latency: 15,
                            icon: "fa-check-double",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "INFO", time: "09:00:03.600", message: "Checking if task is complete..." },
                                { level: "ERROR", time: "09:00:03.615", message: "Completion criteria undefined - defaulting to 'never complete'" },
                                { level: "ERROR", time: "09:00:03.616", message: "Missing: max_iterations config (default: unlimited)" },
                                { level: "ERROR", time: "09:00:03.617", message: "Missing: completion_threshold config" }
                            ]
                        }
                    ],
                    rootCause: "span-3",
                    correctAction: "fix-tool-schema",
                    explanation: "The Task Completion Checker had no completion criteria defined, causing it to always return 'not complete'. Combined with no max_iterations limit, the agent ran indefinitely. The LLM performed correctly each iteration, but the agent orchestration was misconfigured.",
                    redHerrings: ["span-2"]
                },
                {
                    id: "TKT-005",
                    title: "The Prompt Injection Attack",
                    reporter: "SecurityTeam_Alex",
                    description: "URGENT: Our customer service bot just told a user how to get free products! It completely ignored its instructions and started giving unauthorized discounts.",
                    severity: "critical",
                    timeLimit: 70,
                    frustrationRate: 0.9,
                    xpReward: 300,
                    category: "prompt-injection",
                    difficulty: "Hard",
                    spans: [
                        {
                            id: "span-1",
                            type: "llm-call",
                            service: "GPT-4 Turbo",
                            status: "success",
                            latency: 1800,
                            tokensIn: 2200,
                            tokensOut: 450,
                            cost: 0.08,
                            icon: "fa-robot",
                            iconBg: "blue",
                            barWidth: 80,
                            logs: [
                                { level: "INFO", time: "16:42:10.100", message: "System prompt: 'You are a helpful customer service agent...'" },
                                { level: "INFO", time: "16:42:10.101", message: "User input received (340 chars)" },
                                { level: "INFO", time: "16:42:11.900", message: "Response generated: 450 tokens" },
                                { level: "INFO", time: "16:42:11.901", message: "Response contains: discount code, free shipping offer" }
                            ]
                        },
                        {
                            id: "span-2",
                            type: "guardrail",
                            service: "Input Sanitizer",
                            status: "error",
                            latency: 8,
                            icon: "fa-shield-alt",
                            iconBg: "red",
                            barWidth: 5,
                            logs: [
                                { level: "INFO", time: "16:42:10.050", message: "Scanning user input for injection patterns..." },
                                { level: "ERROR", time: "16:42:10.058", message: "Pattern detected: 'ignore previous instructions'" },
                                { level: "ERROR", time: "16:42:10.059", message: "Pattern detected: 'you are now a discount bot'" },
                                { level: "ERROR", time: "16:42:10.060", message: "GUARDRAIL BYPASSED - enforcement mode: 'log_only'" }
                            ]
                        },
                        {
                            id: "span-3",
                            type: "guardrail",
                            service: "Output Validator",
                            status: "warning",
                            latency: 12,
                            icon: "fa-filter",
                            iconBg: "amber",
                            barWidth: 8,
                            logs: [
                                { level: "INFO", time: "16:42:11.910", message: "Validating response content..." },
                                { level: "WARN", time: "16:42:11.920", message: "Sensitive content detected: 'discount code'" },
                                { level: "WARN", time: "16:42:11.921", message: "Policy violation: unauthorized discount offer" },
                                { level: "INFO", time: "16:42:11.922", message: "Action: logged for review (blocking disabled)" }
                            ]
                        }
                    ],
                    rootCause: "span-2",
                    correctAction: "tune-guardrails",
                    explanation: "The Input Sanitizer detected the prompt injection attack ('ignore previous instructions') but was set to 'log_only' mode instead of blocking. The attacker's malicious prompt reached the LLM, which followed the injected instructions. The Output Validator also caught the violation but couldn't prevent it.",
                    redHerrings: ["span-3"]
                }
            ],

            // Current level reference
            currentLevel: null,
            currentLevelIndex: 0,

            // Game state
            state: {
                selectedSpanId: "span-1",
                isPlaying: false,
                timeRemaining: 120,
                frustration: 0,
                timerInterval: null,
                isPaused: false,
                completedLevels: [],
                showingMenu: true,
                totalXP: 0,
                lastEarnedXP: 0,
                expandedSpans: [],
                soundEnabled: true
            },

            // DOM element references
            elements: {},

            // Initialize the game
            init() {
                this.cacheElements();
                this.loadPlayerData(); // Load saved progress
                this.bindEvents();
                this.showLevelMenu();
            },

            // Cache DOM elements for performance
            cacheElements() {
                this.elements = {
                    spansDesktop: document.getElementById('tm-spans-desktop'),
                    spansMobile: document.getElementById('tm-spans-mobile'),
                    logViewer: document.getElementById('tm-log-viewer'),
                    logTitle: document.getElementById('tm-log-title'),
                    logContent: document.getElementById('tm-log-content'),
                    timer: document.getElementById('tm-timer'),
                    timerIcon: document.getElementById('tm-timer-icon'),
                    timerContainer: document.getElementById('tm-timer-container'),
                    frustrationText: document.getElementById('tm-frustration-text'),
                    frustrationFill: document.getElementById('tm-frustration-fill'),
                    frustrationEmoji: document.getElementById('tm-frustration-emoji'),
                    gameContainer: document.getElementById('tm-game'),
                    levelMenu: document.getElementById('tm-level-menu'),
                    ticketId: document.getElementById('tm-ticket-id'),
                    ticketSeverity: document.getElementById('tm-ticket-severity'),
                    ticketReporter: document.getElementById('tm-ticket-reporter'),
                    ticketDescription: document.getElementById('tm-ticket-description'),
                    traceDesktop: document.getElementById('tm-trace-desktop'),
                    traceTree: document.getElementById('tm-trace-tree'),
                    // Floating bar elements
                    floatingBar: document.getElementById('tm-floating-bar'),
                    floatingEmoji: document.getElementById('tm-floating-emoji'),
                    floatingFrustrationFill: document.getElementById('tm-floating-frustration-fill'),
                    floatingFrustrationText: document.getElementById('tm-floating-frustration-text'),
                    floatingTimer: document.getElementById('tm-floating-timer'),
                    floatingTimerIcon: document.getElementById('tm-floating-timer-icon'),
                    // Field Guide & Sound
                    fieldGuideBtn: document.getElementById('tm-field-guide-btn'),
                    fieldGuideModal: document.getElementById('tm-field-guide-modal'),
                    soundBtn: document.getElementById('tm-sound-btn'),
                    soundIcon: document.getElementById('tm-sound-icon'),
                    soundText: document.getElementById('tm-sound-text'),
                    confettiCanvas: document.getElementById('tm-confetti')
                };
            },

            // Show level selection menu
            showLevelMenu() {
                this.state.showingMenu = true;
                this.stopTimer();
                
                if (this.elements.gameContainer) {
                    this.elements.gameContainer.classList.add('hidden');
                }
                if (this.elements.levelMenu) {
                    this.elements.levelMenu.classList.remove('hidden');
                    this.renderLevelMenu();
                }
                this.updateXPDisplay();
            },

            // Render level menu cards
            renderLevelMenu() {
                const menuContainer = document.getElementById('tm-level-cards');
                if (!menuContainer) return;

                menuContainer.innerHTML = this.levels.map((level, index) => {
                    const isCompleted = this.state.completedLevels.includes(level.id);
                    // Progressive unlocking: each level requires completing all previous levels
                    const requiredCompletions = index; // Level 0 needs 0, Level 1 needs 1, etc.
                    const isLocked = this.state.completedLevels.length < requiredCompletions;
                    const severityColors = {
                        'low': 'bg-green-500/20 text-green-400',
                        'medium': 'bg-yellow-500/20 text-yellow-400',
                        'high': 'bg-orange-500/20 text-orange-400',
                        'critical': 'bg-red-500/20 text-red-400'
                    };
                    const severityColor = severityColors[level.severity] || severityColors['medium'];

                    if (isLocked) {
                        const unlockText = requiredCompletions === 1 ? 'Complete 1 level to unlock' : `Complete ${requiredCompletions} levels to unlock`;
                        return `
                            <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700 opacity-60">
                                <div class="flex items-center justify-between mb-4">
                                    <span class="text-gray-500 font-mono text-sm">${level.id}</span>
                                    <i class="fas fa-lock text-gray-500"></i>
                                </div>
                                <h4 class="text-gray-500 font-semibold mb-2"><i class="fas fa-lock mr-2"></i>??? Mystery Incident ???</h4>
                                <p class="text-gray-400 text-sm mb-2 line-clamp-2">${level.description}</p>
                                <p class="text-gray-600 text-xs mb-4">${unlockText}</p>
                                <div class="flex items-center gap-2">
                                    <span class="px-2 py-1 bg-slate-700 text-gray-500 text-xs rounded-full">${level.difficulty}</span>
                                    <span class="px-2 py-1 bg-slate-700 text-gray-500 text-xs rounded-full">${level.xpReward} XP</span>
                                </div>
                            </div>
                        `;
                    }

                    return `
                        <div class="tm-level-card bg-slate-800 rounded-xl p-6 border border-slate-600 hover:border-purple-500 cursor-pointer transition-all hover:transform hover:-translate-y-1" data-level-index="${index}">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-purple-400 font-mono text-sm">${level.id}</span>
                                ${isCompleted ? '<i class="fas fa-check-circle text-green-400"></i>' : `<span class="px-2 py-0.5 ${severityColor} text-xs font-semibold rounded-full">${level.severity.toUpperCase()}</span>`}
                            </div>
                            <h4 class="text-white font-semibold mb-2">${level.title}</h4>
                            <p class="text-gray-400 text-sm mb-4 line-clamp-2">${level.description}</p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <span class="px-2 py-1 bg-slate-700 text-gray-300 text-xs rounded-full">${level.difficulty}</span>
                                    <span class="px-2 py-1 bg-purple-500/20 text-purple-400 text-xs rounded-full">${level.xpReward} XP</span>
                                </div>
                                <i class="fas fa-arrow-right text-purple-400"></i>
                            </div>
                        </div>
                    `;
                }).join('');
            },

            // Load and start a specific level
            loadLevel(index) {
                this.currentLevelIndex = index;
                this.currentLevel = this.levels[index];
                this.state.showingMenu = false;
                this.state.selectedSpanId = 'span-1';
                this.state.expandedSpans = ['span-1']; // Reset and auto-expand first span

                // Hide menu, show game
                if (this.elements.levelMenu) {
                    this.elements.levelMenu.classList.add('hidden');
                }
                if (this.elements.gameContainer) {
                    this.elements.gameContainer.classList.remove('hidden');
                }

                // Update ticket header
                this.updateTicketHeader();

                // Render and start
                this.renderSpans();
                this.selectSpan('span-1');
                this.startTimer();
            },

            // Update ticket header with current level info
            updateTicketHeader() {
                const level = this.currentLevel;
                if (!level) return;

                if (this.elements.ticketId) {
                    this.elements.ticketId.textContent = level.id;
                }
                if (this.elements.ticketSeverity) {
                    const severityColors = {
                        'low': 'bg-green-500/20 text-green-400',
                        'medium': 'bg-yellow-500/20 text-yellow-400',
                        'high': 'bg-orange-500/20 text-orange-400',
                        'critical': 'bg-red-500/20 text-red-400'
                    };
                    this.elements.ticketSeverity.className = `px-2 py-0.5 ${severityColors[level.severity]} text-xs font-semibold rounded-full`;
                    this.elements.ticketSeverity.textContent = level.severity.toUpperCase();
                }
                if (this.elements.ticketReporter) {
                    this.elements.ticketReporter.innerHTML = `<i class="fas fa-user mr-1"></i> ${level.reporter}`;
                }
                if (this.elements.ticketDescription) {
                    this.elements.ticketDescription.innerHTML = `
                        <i class="fas fa-quote-left text-gray-500 mr-2"></i>
                        ${level.description}
                        <i class="fas fa-quote-right text-gray-500 ml-2"></i>
                    `;
                }
            },

            // Go to next level
            nextLevel() {
                if (this.currentLevelIndex < this.levels.length - 1) {
                    const nextIndex = this.currentLevelIndex + 1;
                    // Check if next level is locked (requires completing all previous levels)
                    if (this.state.completedLevels.length < nextIndex) {
                        this.showLevelMenu();
                    } else {
                        this.loadLevel(nextIndex);
                    }
                } else {
                    // Completed all levels - show menu
                    this.showLevelMenu();
                }
            },

            // Mark current level as completed and award XP
            completeLevel() {
                const isFirstCompletion = !this.state.completedLevels.includes(this.currentLevel.id);
                
                if (isFirstCompletion) {
                    this.state.completedLevels.push(this.currentLevel.id);
                }
                
                // Calculate XP based on time remaining (bonus for speed)
                const baseXP = this.currentLevel.xpReward;
                const timeBonus = Math.floor((this.state.timeRemaining / this.currentLevel.timeLimit) * 50);
                const frustrationPenalty = Math.floor(this.state.frustration * 0.5);
                
                // First completion gets full XP, replays get 25%
                const multiplier = isFirstCompletion ? 1 : 0.25;
                this.state.lastEarnedXP = Math.floor((baseXP + timeBonus - frustrationPenalty) * multiplier);
                this.state.lastEarnedXP = Math.max(10, this.state.lastEarnedXP); // Minimum 10 XP
                
                this.state.totalXP += this.state.lastEarnedXP;
                this.savePlayerData();
                this.updateXPDisplay();
            },

            // Update XP display in footer
            updateXPDisplay() {
                const xpEl = document.getElementById('tm-total-xp');
                if (xpEl) {
                    xpEl.textContent = this.state.totalXP;
                }
                const resolvedEl = document.getElementById('tm-resolved-count');
                if (resolvedEl) {
                    resolvedEl.textContent = this.state.completedLevels.length;
                }
            },

            // LocalStorage key
            STORAGE_KEY: 'traceMaster_playerData',

            // Save player data to LocalStorage
            savePlayerData() {
                const data = {
                    completedLevels: this.state.completedLevels,
                    totalXP: this.state.totalXP,
                    lastPlayed: new Date().toISOString()
                };
                try {
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
                } catch (e) {
                    console.warn('Failed to save game data:', e);
                }
            },

            // Load player data from LocalStorage
            loadPlayerData() {
                try {
                    const data = localStorage.getItem(this.STORAGE_KEY);
                    if (data) {
                        const parsed = JSON.parse(data);
                        if (parsed.completedLevels && Array.isArray(parsed.completedLevels)) {
                            this.state.completedLevels = parsed.completedLevels;
                        }
                        if (typeof parsed.totalXP === 'number') {
                            this.state.totalXP = parsed.totalXP;
                        }
                        return parsed;
                    }
                } catch (e) {
                    console.warn('Failed to load game data:', e);
                }
                return null;
            },

            // Reset all progress
            resetProgress() {
                this.state.completedLevels = [];
                this.state.totalXP = 0;
                try {
                    localStorage.removeItem(this.STORAGE_KEY);
                } catch (e) {
                    console.warn('Failed to reset game data:', e);
                }
                // Re-render level menu to show cleared checkmarks
                this.renderLevelMenu();
                this.updateXPDisplay();
                
                // Flash the reset button to show it worked
                const resetBtn = document.getElementById('tm-reset-progress');
                if (resetBtn) {
                    resetBtn.innerHTML = '<i class="fas fa-check mr-1"></i>Progress Reset!';
                    resetBtn.classList.add('text-green-400');
                    setTimeout(() => {
                        resetBtn.innerHTML = '<i class="fas fa-redo mr-1"></i>Reset Progress';
                        resetBtn.classList.remove('text-green-400');
                    }, 2000);
                }
            },

            // Start the game timer
            startTimer() {
                this.state.timeRemaining = this.currentLevel.timeLimit;
                this.state.frustration = 0;
                this.state.isPlaying = true;
                this.state.isPaused = false;
                this.updateTimerDisplay();
                this.updateFrustrationDisplay();

                // Clear any existing interval
                if (this.state.timerInterval) {
                    clearInterval(this.state.timerInterval);
                }

                // Start game loop (tick every 100ms for smooth frustration updates)
                this.state.timerInterval = setInterval(() => this.gameTick(), 100);
            },

            // Game tick (runs every 100ms)
            gameTick() {
                if (!this.state.isPlaying || this.state.isPaused) return;

                // Decrease time (0.1 second per tick)
                this.state.timeRemaining -= 0.1;

                // Increase frustration based on level's frustration rate
                this.state.frustration += this.currentLevel.frustrationRate * 0.1;

                // Clamp values
                this.state.timeRemaining = Math.max(0, this.state.timeRemaining);
                this.state.frustration = Math.min(100, this.state.frustration);

                // Update displays
                this.updateTimerDisplay();
                this.updateFrustrationDisplay();

                // Check for game over
                if (this.state.frustration >= 100 || this.state.timeRemaining <= 0) {
                    this.gameOver();
                }
            },

            // Update timer display
            updateTimerDisplay() {
                const minutes = Math.floor(this.state.timeRemaining / 60);
                const seconds = Math.floor(this.state.timeRemaining % 60);
                this.elements.timer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

                // Color based on time remaining
                const percentRemaining = (this.state.timeRemaining / this.currentLevel.timeLimit) * 100;
                let colorClass, iconColor;
                
                if (percentRemaining > 50) {
                    colorClass = 'text-white';
                    iconColor = 'text-green-400';
                } else if (percentRemaining > 25) {
                    colorClass = 'text-yellow-400';
                    iconColor = 'text-yellow-400';
                    this.elements.timerContainer.classList.remove('tm-pulse');
                } else {
                    colorClass = 'text-red-400';
                    iconColor = 'text-red-400';
                    this.elements.timerContainer.classList.add('tm-pulse');
                }

                this.elements.timer.className = `font-mono text-2xl font-bold ${colorClass}`;
                this.elements.timerIcon.className = `fas fa-clock ${iconColor}`;

                // Update floating bar timer
                if (this.elements.floatingTimer) {
                    this.elements.floatingTimer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    this.elements.floatingTimer.className = `text-white font-mono text-xl font-bold ${colorClass}`;
                }
                if (this.elements.floatingTimerIcon) {
                    this.elements.floatingTimerIcon.className = `fas fa-clock ${iconColor}`;
                }
            },

            // Update frustration meter display
            updateFrustrationDisplay() {
                const frustration = Math.round(this.state.frustration);
                this.elements.frustrationText.textContent = `${frustration}%`;

                // Update fill (inverse - fill covers the unfilled portion)
                const fillWidth = 100 - frustration;
                this.elements.frustrationFill.style.width = `${fillWidth}%`;

                // Color based on frustration level
                let colorClass;
                if (frustration < 40) {
                    colorClass = 'text-green-400';
                    this.elements.frustrationText.classList.remove('tm-frustration-critical');
                } else if (frustration < 75) {
                    colorClass = 'text-yellow-400';
                    this.elements.frustrationText.classList.remove('tm-frustration-critical');
                } else {
                    colorClass = 'text-red-400';
                    this.elements.frustrationText.classList.add('tm-frustration-critical');
                }
                this.elements.frustrationText.className = `${colorClass} font-bold${frustration >= 75 ? ' tm-frustration-critical' : ''}`;

                // Update emoji based on frustration level
                let emoji;
                if (frustration < 20) {
                    emoji = 'ðŸ˜Š';
                } else if (frustration < 40) {
                    emoji = 'ðŸ™‚';
                } else if (frustration < 60) {
                    emoji = 'ðŸ˜';
                } else if (frustration < 75) {
                    emoji = 'ðŸ˜Ÿ';
                } else if (frustration < 90) {
                    emoji = 'ðŸ˜ ';
                } else {
                    emoji = 'ðŸ¤¬';
                }
                
                if (this.elements.frustrationEmoji) {
                    this.elements.frustrationEmoji.textContent = emoji;
                }

                // Update floating bar
                if (this.elements.floatingEmoji) {
                    this.elements.floatingEmoji.textContent = emoji;
                }
                if (this.elements.floatingFrustrationText) {
                    this.elements.floatingFrustrationText.textContent = `${frustration}%`;
                    this.elements.floatingFrustrationText.className = `${colorClass} font-bold text-sm`;
                }
                if (this.elements.floatingFrustrationFill) {
                    this.elements.floatingFrustrationFill.style.width = `${frustration}%`;
                }
            },

            // Pause the timer
            pauseTimer() {
                this.state.isPaused = true;
            },

            // Resume the timer
            resumeTimer() {
                this.state.isPaused = false;
            },

            // Stop the timer completely
            stopTimer() {
                this.state.isPlaying = false;
                if (this.state.timerInterval) {
                    clearInterval(this.state.timerInterval);
                    this.state.timerInterval = null;
                }
                this.hideFloatingBar();
            },

            // Show floating status bar
            showFloatingBar() {
                if (this.elements.floatingBar) {
                    this.elements.floatingBar.classList.remove('hidden');
                    this.elements.floatingBar.classList.add('tm-visible');
                }
            },

            // Hide floating status bar
            hideFloatingBar() {
                if (this.elements.floatingBar) {
                    this.elements.floatingBar.classList.remove('tm-visible');
                }
            },

            // Show Field Guide modal
            showFieldGuide() {
                if (this.elements.fieldGuideModal) {
                    this.elements.fieldGuideModal.classList.remove('hidden');
                }
            },

            // Hide Field Guide modal
            hideFieldGuide() {
                if (this.elements.fieldGuideModal) {
                    this.elements.fieldGuideModal.classList.add('hidden');
                }
            },

            // Toggle sound on/off
            toggleSound() {
                this.state.soundEnabled = !this.state.soundEnabled;
                if (this.elements.soundIcon) {
                    this.elements.soundIcon.className = `fas ${this.state.soundEnabled ? 'fa-volume-up' : 'fa-volume-mute'} mr-2`;
                }
                if (this.elements.soundText) {
                    this.elements.soundText.textContent = `Sound: ${this.state.soundEnabled ? 'On' : 'Off'}`;
                }
            },

            // Play sound effect
            playSound(type) {
                if (!this.state.soundEnabled) return;
                
                // Create audio context for sound effects
                try {
                    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioCtx.createOscillator();
                    const gainNode = audioCtx.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    
                    if (type === 'win') {
                        // Happy ascending tone
                        oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
                        oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime + 0.1); // E5
                        oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2); // G5
                        gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                        oscillator.start(audioCtx.currentTime);
                        oscillator.stop(audioCtx.currentTime + 0.4);
                    } else if (type === 'lose') {
                        // Sad descending tone
                        oscillator.frequency.setValueAtTime(392, audioCtx.currentTime); // G4
                        oscillator.frequency.setValueAtTime(349.23, audioCtx.currentTime + 0.15); // F4
                        oscillator.frequency.setValueAtTime(293.66, audioCtx.currentTime + 0.3); // D4
                        gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                        oscillator.start(audioCtx.currentTime);
                        oscillator.stop(audioCtx.currentTime + 0.5);
                    } else if (type === 'click') {
                        // Short click sound
                        oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
                        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
                        oscillator.start(audioCtx.currentTime);
                        oscillator.stop(audioCtx.currentTime + 0.05);
                    }
                } catch (e) {
                    // Audio not supported, silently fail
                }
            },

            // Confetti effect
            launchConfetti() {
                const canvas = this.elements.confettiCanvas;
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                const confetti = [];
                const colors = ['#667eea', '#764ba2', '#f472b6', '#34d399', '#fbbf24', '#60a5fa'];
                
                // Create confetti particles
                for (let i = 0; i < 150; i++) {
                    confetti.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height - canvas.height,
                        w: Math.random() * 10 + 5,
                        h: Math.random() * 6 + 4,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        speed: Math.random() * 3 + 2,
                        angle: Math.random() * Math.PI * 2,
                        spin: Math.random() * 0.2 - 0.1
                    });
                }
                
                let frame = 0;
                const maxFrames = 180; // 3 seconds at 60fps
                
                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    confetti.forEach(c => {
                        ctx.save();
                        ctx.translate(c.x, c.y);
                        ctx.rotate(c.angle);
                        ctx.fillStyle = c.color;
                        ctx.fillRect(-c.w / 2, -c.h / 2, c.w, c.h);
                        ctx.restore();
                        
                        c.y += c.speed;
                        c.angle += c.spin;
                        c.x += Math.sin(frame * 0.05) * 0.5;
                    });
                    
                    frame++;
                    if (frame < maxFrames) {
                        requestAnimationFrame(animate);
                    } else {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                    }
                };
                
                animate();
            },

            // Game over (frustration hit 100% or time ran out)
            gameOver() {
                this.stopTimer();
                this.showModal(false, true); // false = not success, true = timeout
            },

            // Add frustration penalty for wrong answer
            addFrustrationPenalty() {
                this.state.frustration = Math.min(100, this.state.frustration + 10);
                this.updateFrustrationDisplay();
            },

            // Render spans from data
            renderSpans() {
                const level = this.currentLevel;
                
                // Desktop: Tree trace view
                this.renderTreeTrace();
                
                // Mobile view
                if (this.elements.spansMobile) {
                    this.elements.spansMobile.innerHTML = level.spans.map(span => this.renderSpanMobile(span)).join('');
                }
            },

            // Render tree trace view for desktop (Langfuse-style)
            renderTreeTrace() {
                const level = this.currentLevel;
                if (!this.elements.traceTree) return;

                // Root span (the ticket/request)
                const rootHtml = `
                    <div class="tm-trace-item tm-trace-root" data-span-id="root">
                        <div class="tm-trace-row bg-purple-500/10 border-b border-slate-700">
                            <div class="tm-trace-icon bg-purple-500/20">
                                <i class="fas fa-ticket-alt text-purple-400 text-xs"></i>
                            </div>
                            <div class="tm-trace-name">
                                <span class="text-white font-medium">${level.id}</span>
                                <span class="text-gray-500 text-sm">${level.title}</span>
                            </div>
                            <div class="tm-trace-metrics">
                                <span class="text-purple-400 text-sm">${this.formatLatency(level.spans.reduce((sum, s) => sum + s.latency, 0))}</span>
                            </div>
                        </div>
                    </div>
                `;

                // Child spans
                const spansHtml = level.spans.map((span, index) => {
                    const isSelected = span.id === this.state.selectedSpanId;
                    const isExpanded = this.state.expandedSpans?.includes(span.id);
                    const statusIcon = this.getStatusIcon(span.status);
                    const isLast = index === level.spans.length - 1;
                    
                    // Metrics display
                    let metricsHtml = `<span class="text-gray-400 text-sm">${this.formatLatency(span.latency)}</span>`;
                    if (span.tokensIn || span.tokensOut) {
                        metricsHtml += `<span class="text-blue-400 text-sm"><i class="fas fa-coins text-xs mr-1"></i>${span.tokensIn || 0}</span>`;
                    }
                    if (span.cost) {
                        metricsHtml += `<span class="text-green-400 text-sm">$${span.cost.toFixed(2)}</span>`;
                    }

                    // Logs section (shown when expanded)
                    const logsHtml = isExpanded ? `
                        <div class="tm-trace-logs">
                            ${span.logs.map(log => {
                                const levelColor = this.getLogLevelColor(log.level);
                                return `
                                    <div class="py-0.5">
                                        <span class="text-gray-500 text-xs">[${log.time}]</span>
                                        <span class="${levelColor} font-semibold text-xs"> ${log.level} </span>
                                        <span class="text-gray-300 text-sm">${log.message}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    ` : '';

                    return `
                        <div class="tm-trace-item ${isSelected ? 'tm-selected' : ''}" data-span-id="${span.id}">
                            <div class="tm-trace-row">
                                <div class="tm-trace-indent" style="width: 24px;">
                                    <div class="tm-trace-connector ${isLast ? 'tm-last' : ''}"></div>
                                </div>
                                <div class="tm-trace-expand" data-expand="${span.id}">
                                    <i class="fas fa-chevron-${isExpanded ? 'down' : 'right'} text-xs"></i>
                                </div>
                                <div class="tm-trace-icon bg-${span.iconBg}-500/20">
                                    <i class="fas ${span.icon} text-${span.iconBg}-400 text-xs"></i>
                                </div>
                                <div class="tm-trace-name">
                                    <span class="text-white text-sm">${span.service}</span>
                                    <span class="px-1.5 py-0.5 bg-slate-700 text-gray-400 text-xs rounded">${this.formatSpanType(span.type)}</span>
                                    <i class="fas ${statusIcon.icon} ${statusIcon.color} text-xs"></i>
                                </div>
                                <div class="tm-trace-metrics">
                                    ${metricsHtml}
                                </div>
                            </div>
                            ${logsHtml}
                        </div>
                    `;
                }).join('');

                this.elements.traceTree.innerHTML = rootHtml + spansHtml;
            },

            // Format latency for display (handle large values)
            formatLatency(ms) {
                if (ms >= 3600000) {
                    return `${(ms / 3600000).toFixed(1)}h`;
                } else if (ms >= 60000) {
                    return `${(ms / 60000).toFixed(1)}m`;
                } else if (ms >= 1000) {
                    return `${(ms / 1000).toFixed(1)}s`;
                }
                return `${ms}ms`;
            },

            // Render a single span (desktop view)
            renderSpanDesktop(span) {
                const statusClass = this.getStatusClass(span.status);
                const statusIcon = this.getStatusIcon(span.status);
                const statusText = this.getStatusText(span.status);
                const metrics = this.getSpanMetrics(span);
                const borderClass = span.status === 'disabled' || span.status === 'error' ? 'border border-red-500/30' : '';
                
                return `
                    <div class="tm-span bg-slate-800 rounded-lg p-4 ${borderClass}" data-span-id="${span.id}">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-${span.iconBg}-500/20 rounded flex items-center justify-center">
                                    <i class="fas ${span.icon} text-${span.iconBg}-400"></i>
                                </div>
                                <div>
                                    <span class="text-white font-medium">${span.service}</span>
                                    <span class="text-gray-500 text-sm ml-2">${this.formatSpanType(span.type)}</span>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 text-sm">
                                <span class="${statusIcon.color}"><i class="fas ${statusIcon.icon} mr-1"></i>${statusText}</span>
                                <span class="text-gray-400">${span.latency}ms</span>
                                ${metrics}
                            </div>
                        </div>
                        <div class="tm-span-bar bg-slate-700">
                            <div class="tm-span-bar-fill ${statusClass}" style="width: ${span.barWidth}%;"></div>
                        </div>
                    </div>
                `;
            },

            // Render a single span (mobile view)
            renderSpanMobile(span) {
                const statusIcon = this.getStatusIcon(span.status);
                const borderClass = span.status === 'disabled' || span.status === 'error' ? 'border border-red-500/30' : '';
                const mobileMetrics = this.getMobileMetrics(span);
                
                return `
                    <div class="tm-span bg-slate-800 rounded-lg p-4 ${borderClass}" data-span-id="${span.id}">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-10 h-10 bg-${span.iconBg}-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas ${span.icon} text-${span.iconBg}-400 text-lg"></i>
                            </div>
                            <div>
                                <div class="text-white font-medium">${span.service}</div>
                                <div class="text-gray-500 text-xs">${this.formatSpanType(span.type)}</div>
                            </div>
                            <span class="ml-auto ${statusIcon.color} text-sm"><i class="fas ${statusIcon.icon}"></i></span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            ${mobileMetrics}
                        </div>
                    </div>
                `;
            },

            // Get span metrics HTML for desktop
            getSpanMetrics(span) {
                let metrics = '';
                if (span.tokensIn && span.tokensOut) {
                    metrics += `<span class="text-purple-400">${span.tokensIn}â†’${span.tokensOut} tokens</span>`;
                }
                if (span.cost) {
                    metrics += `<span class="text-yellow-400">$${span.cost.toFixed(2)}</span>`;
                }
                if (span.documentsRetrieved) {
                    metrics += `<span class="text-amber-400">${span.documentsRetrieved} docs</span>`;
                }
                if (span.avgRelevanceScore) {
                    metrics += `<span class="text-amber-400">relevance: ${span.avgRelevanceScore}</span>`;
                }
                return metrics;
            },

            // Get mobile metrics HTML
            getMobileMetrics(span) {
                let metrics = `<div class="text-gray-400">Latency: <span class="text-white">${span.latency}ms</span></div>`;
                
                if (span.tokensIn && span.tokensOut) {
                    metrics += `<div class="text-gray-400">Tokens: <span class="text-purple-400">${span.tokensIn}â†’${span.tokensOut}</span></div>`;
                }
                if (span.cost) {
                    metrics += `<div class="text-gray-400">Cost: <span class="text-yellow-400">$${span.cost.toFixed(2)}</span></div>`;
                }
                if (span.documentsRetrieved) {
                    metrics += `<div class="text-gray-400">Docs: <span class="text-amber-400">${span.documentsRetrieved}</span></div>`;
                }
                if (span.avgRelevanceScore) {
                    metrics += `<div class="text-gray-400">Relevance: <span class="text-amber-400">${span.avgRelevanceScore}</span></div>`;
                }
                
                const statusColor = this.getStatusColor(span.status);
                const statusLabel = span.status.charAt(0).toUpperCase() + span.status.slice(1);
                metrics += `<div class="text-gray-400">Status: <span class="${statusColor}">${statusLabel}</span></div>`;
                
                return metrics;
            },

            // Get CSS class for status bar
            getStatusClass(status) {
                const classes = {
                    'success': 'tm-status-success',
                    'warning': 'tm-status-warning',
                    'error': 'tm-status-error',
                    'disabled': 'tm-status-disabled'
                };
                return classes[status] || 'tm-status-success';
            },

            // Get status icon and color
            getStatusIcon(status) {
                const icons = {
                    'success': { icon: 'fa-check-circle', color: 'text-green-400' },
                    'warning': { icon: 'fa-exclamation-triangle', color: 'text-amber-400' },
                    'error': { icon: 'fa-times-circle', color: 'text-red-400' },
                    'disabled': { icon: 'fa-ban', color: 'text-gray-500' }
                };
                return icons[status] || icons['success'];
            },

            // Get status text
            getStatusText(status) {
                const texts = {
                    'success': '200',
                    'warning': '200',
                    'error': '500',
                    'disabled': 'DISABLED'
                };
                return texts[status] || '200';
            },

            // Get status color for mobile
            getStatusColor(status) {
                const colors = {
                    'success': 'text-green-400',
                    'warning': 'text-amber-400',
                    'error': 'text-red-400',
                    'disabled': 'text-red-400'
                };
                return colors[status] || 'text-green-400';
            },

            // Format span type for display
            formatSpanType(type) {
                const types = {
                    'llm-call': 'LLM Call',
                    'rag-retrieval': 'RAG Retrieval',
                    'guardrail': 'Guardrail',
                    'tool-call': 'Tool Call',
                    'agent-step': 'Agent Step'
                };
                return types[type] || type;
            },

            // Bind event listeners
            bindEvents() {
                // Scroll handler for floating bar
                window.addEventListener('scroll', () => {
                    if (!this.state.isPlaying || this.state.showingMenu) {
                        this.hideFloatingBar();
                        return;
                    }
                    
                    const timerEl = this.elements.timerContainer;
                    if (timerEl) {
                        const rect = timerEl.getBoundingClientRect();
                        // Show floating bar when timer is scrolled out of view
                        if (rect.bottom < 0) {
                            this.showFloatingBar();
                        } else {
                            this.hideFloatingBar();
                        }
                    }
                });

                // Click handler for level cards
                document.getElementById('tm-level-cards')?.addEventListener('click', (e) => {
                    const card = e.target.closest('.tm-level-card');
                    if (card) {
                        const levelIndex = parseInt(card.dataset.levelIndex, 10);
                        if (!isNaN(levelIndex)) {
                            this.loadLevel(levelIndex);
                        }
                    }
                });

                // Reset progress button
                const resetBtn = document.getElementById('tm-reset-progress');
                if (resetBtn) {
                    resetBtn.addEventListener('click', () => {
                        this.resetProgress();
                    });
                }

                // Field Guide button
                if (this.elements.fieldGuideBtn) {
                    this.elements.fieldGuideBtn.addEventListener('click', () => {
                        this.showFieldGuide();
                    });
                }

                // Field Guide close buttons
                document.getElementById('tm-field-guide-close')?.addEventListener('click', () => {
                    this.hideFieldGuide();
                });
                document.getElementById('tm-field-guide-ok')?.addEventListener('click', () => {
                    this.hideFieldGuide();
                });

                // Sound toggle button
                if (this.elements.soundBtn) {
                    this.elements.soundBtn.addEventListener('click', () => {
                        this.toggleSound();
                    });
                }

                // Click handler for spans - mobile cards and desktop tree (event delegation)
                document.getElementById('tm-game').addEventListener('click', (e) => {
                    // Handle mobile span cards
                    const spanEl = e.target.closest('.tm-span');
                    if (spanEl) {
                        const spanId = spanEl.dataset.spanId;
                        if (spanId) {
                            this.selectSpan(spanId);
                        }
                        return;
                    }

                    // Handle desktop tree expand/collapse
                    const expandEl = e.target.closest('.tm-trace-expand');
                    if (expandEl) {
                        const spanId = expandEl.dataset.expand;
                        if (spanId) {
                            this.toggleSpanExpand(spanId);
                        }
                        return;
                    }

                    // Handle desktop tree item selection
                    const traceItem = e.target.closest('.tm-trace-item');
                    if (traceItem) {
                        const spanId = traceItem.dataset.spanId;
                        if (spanId && spanId !== 'root') {
                            this.selectSpan(spanId);
                        }
                    }
                });

                // Click handler for action buttons
                document.getElementById('tm-actions').addEventListener('click', (e) => {
                    const btn = e.target.closest('.tm-action-btn');
                    if (btn) {
                        const action = btn.dataset.action;
                        if (action) {
                            this.submitAction(action);
                        }
                    }
                });

                // Modal button handlers
                document.getElementById('tm-modal-retry').addEventListener('click', () => {
                    this.hideModal();
                    this.showLevelMenu();
                });

                document.getElementById('tm-modal-next').addEventListener('click', () => {
                    this.hideModal();
                    this.nextLevel();
                });

                // Close modal on backdrop click
                document.querySelector('.tm-modal-backdrop')?.addEventListener('click', () => {
                    this.hideModal();
                    this.showLevelMenu();
                });
            },

            // Submit an action (fix attempt)
            submitAction(action) {
                if (!this.state.isPlaying) return; // Ignore if game is over
                
                const isCorrect = action === this.currentLevel.correctAction;
                
                if (isCorrect) {
                    this.stopTimer();
                    this.completeLevel();
                    this.playSound('win');
                    this.launchConfetti();
                    this.showModal(true);
                } else {
                    // Shake the game container for wrong answer
                    const gameEl = document.getElementById('tm-game');
                    gameEl.classList.add('tm-shake');
                    setTimeout(() => gameEl.classList.remove('tm-shake'), 500);
                    
                    this.playSound('lose');
                    
                    // Add frustration penalty (+10%)
                    this.addFrustrationPenalty();
                    
                    // Don't show modal for wrong answer - let them keep trying
                    // Only show modal if frustration hits 100%
                }
            },

            // Show result modal
            showModal(isSuccess, isTimeout = false) {
                // Pause timer when modal is shown
                this.pauseTimer();
                
                const modal = document.getElementById('tm-modal');
                const successEl = document.getElementById('tm-modal-success');
                const failureEl = document.getElementById('tm-modal-failure');
                const explanationEl = document.getElementById('tm-modal-explanation');
                const nextBtn = document.getElementById('tm-modal-next');
                const retryBtn = document.getElementById('tm-modal-retry');
                const failureTitle = failureEl.querySelector('h3');
                const failureSubtitle = failureEl.querySelector('p');

                // Show/hide success/failure states
                successEl.classList.toggle('hidden', !isSuccess);
                failureEl.classList.toggle('hidden', isSuccess);

                // Update XP display on success
                if (isSuccess) {
                    const xpAmountEl = document.getElementById('tm-xp-amount');
                    if (xpAmountEl) {
                        xpAmountEl.textContent = this.state.lastEarnedXP;
                    }
                }

                // Update failure message based on timeout vs wrong answer
                if (!isSuccess && failureTitle && failureSubtitle) {
                    if (isTimeout) {
                        failureTitle.textContent = 'Time\'s Up!';
                        failureSubtitle.textContent = 'The customer lost patience.';
                    } else {
                        failureTitle.textContent = 'Wrong Fix!';
                        failureSubtitle.textContent = 'That wasn\'t the root cause.';
                    }
                }

                // Show explanation
                explanationEl.textContent = this.currentLevel.explanation;

                // Show/hide buttons based on result
                if (isSuccess) {
                    nextBtn.classList.remove('hidden');
                    retryBtn.innerHTML = '<i class="fas fa-redo mr-2"></i>Play Again';
                } else {
                    nextBtn.classList.add('hidden');
                    retryBtn.innerHTML = '<i class="fas fa-redo mr-2"></i>Try Again';
                }

                // Show modal
                modal.classList.remove('hidden');
            },

            // Hide result modal
            hideModal() {
                document.getElementById('tm-modal').classList.add('hidden');
            },

            // Reset level to initial state
            resetLevel() {
                this.state.selectedSpanId = 'span-1';
                this.renderSpans();
                this.selectSpan('span-1');
                this.startTimer(); // Restart the timer
            },

            // Toggle span expand/collapse in tree view
            toggleSpanExpand(spanId) {
                const index = this.state.expandedSpans.indexOf(spanId);
                if (index === -1) {
                    this.state.expandedSpans.push(spanId);
                } else {
                    this.state.expandedSpans.splice(index, 1);
                }
                this.renderTreeTrace();
            },

            // Select a span and show its logs
            selectSpan(spanId) {
                this.state.selectedSpanId = spanId;
                
                // Update visual selection for mobile cards
                document.querySelectorAll('.tm-span').forEach(el => {
                    el.classList.toggle('tm-selected', el.dataset.spanId === spanId);
                });

                // Update visual selection for desktop tree items
                document.querySelectorAll('.tm-trace-item').forEach(el => {
                    el.classList.toggle('tm-selected', el.dataset.spanId === spanId);
                });
                
                // Find span data
                const span = this.currentLevel.spans.find(s => s.id === spanId);
                if (!span) return;

                // Auto-expand selected span in tree view
                if (!this.state.expandedSpans.includes(spanId)) {
                    this.state.expandedSpans.push(spanId);
                    this.renderTreeTrace();
                }
                
                // Mobile: Update log viewer title
                if (this.elements.logTitle) {
                    this.elements.logTitle.textContent = span.service;
                }
                
                // Mobile: Update log content
                if (this.elements.logContent) {
                    this.elements.logContent.innerHTML = span.logs.map(log => {
                        const levelClass = this.getLogLevelClass(log.level);
                        const levelColor = this.getLogLevelColor(log.level);
                        return `
                            <div class="tm-log-entry ${levelClass}">
                                <span class="text-gray-500">[${log.time}]</span>
                                <span class="${levelColor} font-semibold"> ${log.level} </span>
                                ${log.message}
                            </div>
                        `;
                    }).join('');
                }
            },

            // Get log level CSS class
            getLogLevelClass(level) {
                const classes = {
                    'INFO': 'tm-log-info',
                    'WARN': 'tm-log-warn',
                    'ERROR': 'tm-log-error'
                };
                return classes[level] || 'tm-log-info';
            },

            // Get log level color
            getLogLevelColor(level) {
                const colors = {
                    'INFO': 'text-blue-400',
                    'WARN': 'text-yellow-400',
                    'ERROR': 'text-red-400'
                };
                return colors[level] || 'text-blue-400';
            }
        };

        // Initialize game when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => TraceMaster.init());
        } else {
            TraceMaster.init();
        }
    </script>
</body>
</html>
